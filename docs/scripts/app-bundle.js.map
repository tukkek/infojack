{"version":3,"sources":["app.js","empty.js","environment.js","infojack-mainmenu.js","infojack-radio.js","infojack-topmenu.js","infojack-win.js","main.js","messages.js","cyberspace/infojack-cyberspace.js","cyberspace/program-bar.js","character/character-abilities.js","character/character-deck.js","character/character-details.js","character/character-feats.js","character/character-general.js","character/character-programs.js","character/character-screen.js","character/character-skills.js","character/character-talents.js","modules/deck.js","modules/grade.js","modules/rpg.js","modules/save.js","modules/sound.js","resources/index.js","modules/character/character.js","modules/character/feat.js","modules/character/occupation.js","modules/character/skill.js","modules/cyberspace/console.js","modules/cyberspace/system.js","modules/program/armor.js","modules/program/blaster.js","modules/program/program.js","modules/character/class/class.js","modules/character/class/webcrawler.js","modules/cyberspace/avatar/alarm.js","modules/cyberspace/avatar/avatar.js","modules/cyberspace/avatar/backdoor.js","modules/cyberspace/avatar/control.js","modules/cyberspace/avatar/entry.js","modules/cyberspace/avatar/file.js","modules/cyberspace/avatar/gateway.js","modules/cyberspace/avatar/map.js","modules/cyberspace/avatar/player.js","modules/cyberspace/avatar/terminal.js","modules/cyberspace/node/cpu.js","modules/cyberspace/node/datastore.js","modules/cyberspace/node/interface.js","modules/cyberspace/node/node.js","modules/cyberspace/node/portal.js","modules/cyberspace/avatar/ice/ice.js","modules/cyberspace/avatar/ice/scout.js"],"names":["App","Example","debug","testing","nodesize","fullattributes","ccskills","playeravatars","revealmap","scannodes","printsave","systemlevel","view","noice","wealth","MainMenu","messaging","show","hassave","checkload","me","setTimeout","close","showpending","play","ERROR","alert","startgame","prompt","confirm","clear","loadgame","load","open","publish","openrepository","window","Radio","active","audio","pause","TopMenu","hideradio","NICE","Win","subscribe","apply","end","levelup","save","abilities","pointextra","skills","ranks","feats","newfeats","nice","choose","location","reload","configure","Promise","config","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","then","setRoot","ShowView","Disconnect","win","message","Refresh","target","refresh","TILESIZE","SPACING","FADETIME","MINIMUMWAIT","current","lastclick","Cyberspace","showconsole","init","map","document","querySelector","console","system","level","player","tiles","drawn","draw","connect","clicktile","tile","now","Date","getTime","tagName","parentNode","node","nodes","nodeid","avatar","getavatar","nodex","nodey","scanned","click","wait","e","disconnect","enter","placenode","placetile","x","y","createElement","push","classList","add","id","onclick","style","width","height","left","top","placespacer","farx","fary","t","offsetLeft","offsetTop","spacer","body","scrollTop","scrollLeft","appendChild","expand","indexOf","getneighbors","n","entrance","scroll","scrollIntoView","addimage","image","src","title","tooltip","removeimage","opacity","fade","removeChild","printmessages","innerHTML","m","next","color","div","createTextNode","text","scrollHeight","refreshtile","visited","border","remove","act","revealed","ProgramBar","BindingSignaler","EventAggregator","signals","collapsed","sort","r","refreshdetails","attached","gethpcolor","hp","green","red","g","b","c","character","maxhp","hpcolor","Math","round","memoryused","totalload","memory","getload","loadcolor","freestorage","storage","storageused","programs","slice","signal","toggle","isloaded","program","loaded","geticonclass","doload","LOAD","dounload","unload","UNLOAD","run","print","name","CharacterAbilities","full","strength","dexterity","constitution","intelligence","wisdom","charisma","pointbuy","clone","Object","assign","upgrade","ability","raised","buy","updateranks","cost","CharacterDeck","possess","electronics","getelectronics","deckgrade","memorygrade","storagegrade","stealthgrade","canupgradedeck","upgradedeck","canupgradememory","upgradememory","canupgradestorage","upgradestorage","canupgradestealth","upgradestealth","grade","i","CharacterDetails","saves","classes","hero","bind","getmodifier","toLowerCase","getsave","getskill","skill","replace","sign","CharacterFeats","viewname","points","feat","validate","getcurrent","f","talent","getall","CharacterGeneral","avatars","focus","select","CharacterPrograms","technology","gettechnology","has","getpurchaselabel","purchasedc","canbuy","cancreate","programmingdc","getprogramminglabel","create","CharacterScreen","showgeneral","showabilities","showskills","showfeats","showtalents","showdetails","showdeck","showprograms","buttons","charactermenu","querySelectorAll","button","CharacterSkills","values","s","getranks","iscrossclass","classskills","includes","canupgrade","setranks","value","getability","substring","toUpperCase","CharacterTalents","talents","Map","get","set","OK","MEMORYUPGRADE","Deck","checkgrade","currentgrade","installdc","result","data","key","a","compare","getfreestorage","deck","grades","CRITICALHIT","CRITICALMISS","Rpg","min","max","floor","random","d","dice","sides","sum","list","length","chancein","shuffle","array","j","swap","randomize","amount","rpg","Save","localStorage","getItem","saveprograms","p","setItem","JSON","stringify","loadprograms","populate","parse","initialize","PREFIX","queue","running","Sound","ALERTCANCEL","ALERTRED","ALERTYELLOW","ATTACK","CONNECT","CRASH","DISABLE","DISCONNECTED","ICEATTACK","ICEENTER","ICELEAVE","MOVE","SCAN","QUERY","process","Audio","shift","onended","file","sound","ABILITYPOINTS","costs","Character","bab","edgedice","edge","fort","ref","will","defence","speed","extratalents","contacts","setoccupation","occupation","addclassskill","enhancecrawler","con","hasfeat","addfeat","featbonus","getbluff","bluff","getconcentration","concentration","getdecryption","decryption","getforgery","forgery","getinformation","information","gethacking","hacking","getperceive","perceive","getmedicine","medicine","getstealth","stealth","getprofession","profession","getresearch","research","getsearch","search","getfortitude","getreflexes","getwill","getinitiative","getdefence","getmelee","getranged","price","difference","sell","upgradewealth","taketen","letter","move","learnskill","undefined","learnability","log","ugpraderanks","learnfeat","advance","adventurer","Feat","description","Talent","Educated","Meticulous","Stealthy","Studious","Trustworthy","ImprovedInitiative","Windfall","Occupation","skillsp","occupations","checkskills","Skill","ss","Message","Console","messages","args","setactive","getactive","System","ice","reentry","generatemap","definenodes","generate","generateice","reveal","scan","getnode","size","leastx","leasty","replacenode","original","findentrance","neighbors","portals","filter","generatenode","setmain","entrancei","corridor","raisealert","raise","previous","credentials","ap","Armor","duration","modify","bonus","describe","armor","Blaster","apcost","damage","attack","SESSION","Number","MAX_SAFE_INTEGER","PROGRAMS","Program","hack","code","hackingdc","basename","ntimes","conflict","splice","localeCompare","Class","upgradehp","hd","upgraderanks","classlevel","stat","upgradestat","upgradeedgedice","upgradereputation","last","split","parseInt","reputation","check","TheWebIsAlive","SpecializedEquipment","Webcrawler","webcrawler","Alarm","setimage","setname","Avatar","obfuscate","scandc","rollinitiative","characterclass","describehealth","health","die","leave","hit","roll","authenticate","hackingroll","querydc","hide","query","getserial","serial","toString","getscale","Backdoor","OUTCOMES","Control","privilege","Entry","NOTDOWNLOADING","File","worthless","trap","protected","downloading","decrypt","download","done","Gateway","Player","penalty","first","percent","status","dc","source","spotter","Terminal","FUNCTIONS","Cpu","priority","Datastore","files","Interface","TILES","Node","xy","Portal","Ice","constructor","getdamage","PATHHISTORY","Scout","path","getdestination","ns","spotdc","spot","ranged"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export class App {\n  constructor() {\n  }\n}\n","export class Example {\n  constructor() {\n  }\n}\n","export default {\n  /* environment */\n  debug:true,\n  testing:true,\n  /* game options */\n  nodesize:4, //grid size for each node\n  fullattributes:false, //no sense in having physical now\n  ccskills:false, //only 1 is cross-class, so disable for now\n  playeravatars:17,\n  /* debug flags (false=disabled) */\n  revealmap:true,\n  scannodes:true,\n  printsave:false, \n  systemlevel:false, //override system level (1-20)\n  view:false, //starting view name\n  noice:false, //skip ICE generation\n  wealth:false, //overrides starting wealth\n};\n","import {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {sound} from './modules/sound';\nimport {save} from './modules/save';\nimport {ShowView} from './messages';\nimport environment from './environment';\n\n@inject(EventAggregator)\nexport class MainMenu {\n    constructor(messaging) {\n        this.show=true;\n        this.messaging=messaging;\n        this.hassave=save.checkload()!=false;\n        if(environment.view){\n          let me=this;\n          setTimeout(function(){\n            me.close(environment.view);}\n          ,1);\n        }\n    }\n  \n    showpending(){\n        sound.play(sound.ERROR);\n        setTimeout(function(){\n            alert('Operation pending!');\n        },100);\n    }\n    \n    startgame(){\n        let prompt='Are you sure you want to start a new game? Any previous progress will be lost!';\n        if(this.hassave&&!confirm(prompt)){\n            return;\n        }\n        save.clear();\n        this.close('CharacterScreen');\n    }\n    \n    loadgame(){\n        if(this.hassave){\n          save.load();\n          this.close('CharacterScreen');\n        }else{\n          sound.play(sound.ERROR);\n          alert('No save found!');\n        }\n    }\n    \n    close(open){\n        this.show=false;\n        this.messaging.publish(new ShowView(open));\n    }\n      \n    openrepository(){\n      window.open('https://github.com/tukkek/infojack');\n    }\n}\n","export class Radio {\n    constructor() {\n        this.active=false;\n    }\n  \n    play(){\n        this.audio.play();\n        if(!this.active){\n            this.audio.play();\n        } else {\n            this.audio.pause();\n        }\n        return true;\n    }\n}\n","export class TopMenu{\n    constructor(){\n        this.hideradio=true;\n    }\n    \n    open(){\n        this.hideradio=!this.hideradio;\n    }\n}\n","import {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {ShowView} from './messages';\nimport {hero} from './modules/character/character';\nimport {rpg} from './modules/rpg';\nimport {save} from './modules/save';\n\nvar NICE=['Alright!','Sweet!','Hell to the yeah!','Score!','Bonus!','♫ A ♫ ma ♫ zing ♫','Groovy!','Hit it Johnny!','Loving it!','Totally radical!','Cowabanga!',\"That's how you do it, chummer.\",'Let it rip, choombata!'];\n\n@inject(EventAggregator)\nexport class Win {\n  constructor(messaging) {\n    this.show=false;\n    let me=this;\n    messaging.subscribe(ShowView,function(show){\n      if(show.view=='Win') me.apply();\n    });\n  }\n  \n  apply(){\n    this.end=!hero.levelup();\n    save.save();\n    this.abilities=hero.pointextra;\n    this.skills=hero.ranks;\n    this.feats=hero.newfeats;\n    this.wealth=hero.wealth+'¥';\n    this.nice=rpg.choose(NICE);\n    this.show=true;\n  }\n  \n  close(){\n    if(!this.end){\n      this.show=false;\n      return;\n    }\n    save.clear();\n    window.location.reload();\n  }\n}\n","import environment from './environment';\n\n//Configure Bluebird Promises.\nPromise.config({\n  warnings: {\n    wForgottenReturn: false\n  }\n});\n\nexport function configure(aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","export class ShowView{\n  constructor(view){this.view=view;}\n}\n\nexport class Disconnect{\n  constructor(win=false){\n    this.win=win;\n    this.message='You have been disconnected!';\n  }\n}\n\nexport class Refresh{\n  constructor(target){this.target=target;}\n}\n","import {System,setactive} from '../modules/cyberspace/system';\nimport {Player} from '../modules/cyberspace/avatar/player';\nimport {console} from '../modules/cyberspace/console';\nimport {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {sound} from '../modules/sound';\nimport {ShowView} from '../messages';\nimport environment from '../environment';\nimport {hero} from '../modules/character/character';\nimport {Disconnect,Refresh} from '../messages';\nimport {deck} from '../modules/deck';\n\nvar TILESIZE=2.5;\nvar SPACING=1.1;\nvar FADETIME=2000;\nvar MINIMUMWAIT=environment.debug?0:1000/2; //once there's realtime, this isn't necessary - can just check if AP<=0 to let a click on the map go through\n\nvar current=false;\nvar lastclick=0;\n\n@inject(EventAggregator)\nexport class Cyberspace{\n  constructor(messaging){\n    this.messaging=messaging;\n    this.showconsole=false;\n    current=this;\n    let me=this;\n    messaging.subscribe(ShowView,function(show){\n      if(show.view=='Cyberspace') me.init();\n    });\n  }\n  \n  init(){\n    //TODO clean previous run\n    this.showconsole=true;\n    this.map=document.querySelector('#cyberspace');\n    this.console=document.querySelector('#console');\n    this.system=\n      new System(environment.systemlevel||hero.level);\n    setactive(this.system);\n    this.player=new Player(this.system);\n    this.tiles=[];\n    this.drawn=[];\n    this.draw();\n    deck.connect(this.system);\n  }\n  \n  clicktile(tile){\n    let now=new Date().getTime();\n    if(lastclick+MINIMUMWAIT>now) return;\n    lastclick=now;\n    if(tile.tagName=='IMG') tile=tile.parentNode;\n    let node=this.system.nodes[tile.nodeid];\n    if(node==this.player.node){\n      let avatar=node.getavatar(tile.nodex,tile.nodey);\n      try{\n        if(avatar&&avatar.scanned) avatar.click();\n        else this.player.wait();\n      }catch(e){\n        if(!this.disconnect(e)) throw e;\n        return;\n      }\n    }else if(this.player.enter(node)) \n      this.placenode(node,true);\n    this.refresh();\n  }\n\n  placetile(x,y,node){\n    let tile=document.createElement('div');\n    this.tiles.push(tile);\n    tile.classList.add('tile');\n    tile.nodeid=node.id;\n    tile.nodex=x;\n    tile.nodey=y;\n    let me=this;\n    tile.onclick=function(){me.clicktile(this);};\n    let style=tile.style;\n    style.width=TILESIZE+'em';\n    style.height=TILESIZE+'em';\n    style.left=(node.x*SPACING*environment.nodesize+x)\n      *TILESIZE+'em';\n    style.top=(node.y*SPACING*environment.nodesize+y)\n      *TILESIZE+'em';\n    return tile;\n  }\n\n  placespacer(){\n    let farx=0;\n    let fary=0;\n    for(let t of this.tiles){\n      if(t.offsetLeft>farx) farx=t.offsetLeft;\n      if(t.offsetTop>fary) fary=t.offsetTop;\n    }\n    let spacer=document.createElement('div');\n    spacer.classList.add('spacer');\n    spacer.style.top=(document.body.scrollTop+fary)+'px';\n    spacer.style.left=(document.body.scrollLeft+farx)+'px';\n    this.map.appendChild(spacer);\n  }\n\n  placenode(node,expand){\n    if(this.drawn.indexOf(node)<0){\n      this.drawn.push(node);\n      for(let x=0;x<environment.nodesize;x++)\n        for(let y=0;y<environment.nodesize;y++)\n          this.map.appendChild(this.placetile(x,y,node));\n    }\n    if(expand) for(let n of node.getneighbors())\n      this.placenode(n,false);\n    let me=this;\n    setTimeout(function(){me.placespacer();},500);\n  }\n\n  draw(){\n    console.system=this.system;\n    this.placenode(this.system.entrance,true);\n    this.player.enter(this.system.entrance);\n    //this.refresh();\n    this.scroll();\n  }\n  \n  scroll(){\n    for(let t of this.tiles) \n      if(t.nodeid==this.player.node.id&&\n        t.nodex==this.player.x&&t.nodey==this.player.y){\n          setTimeout(function(){t.scrollIntoView();},250);\n          return;\n      }\n  }\n\n  addimage(tile,avatar){\n    tile.avatar=avatar;\n    tile.scanned=avatar.scanned;\n    let image=document.createElement('img');\n    image.src=avatar.image;\n    image.title=avatar.tooltip;\n    tile.appendChild(image);\n    tile.image=image;\n  }\n\n  removeimage(tile){\n    tile.avatar=null;\n    tile.image.style.opacity=0;\n    let fade=tile.image;\n    tile.image=null;\n    setTimeout(function(){tile.removeChild(fade);},FADETIME);\n  }\n\n  printmessages(){\n    this.console.innerHTML='';\n    for(let m=console.next();m;m=console.next()){\n      let color=false;\n      if(m.alert==0) color='white';\n      else if(m.alert==1) color='yellow';\n      else if(m.alert==2) color='red';\n      else throw 'Unknown alert level';\n      let div=document.createElement('div');\n      div.style.color=color;\n      div.appendChild(document.createTextNode(m.text));\n      this.console.appendChild(div);\n    }\n    this.console.scrollTop=this.console.scrollHeight;\n  }\n  \n  refreshtile(t){\n    let node=this.system.nodes[t.nodeid];\n    if(t.style.opacity==0) setTimeout(function(){\n      t.classList.add('discovered');\n    },1);\n    if(!node.visited) return;\n    if(!t.style.border) t.classList.add('visited');\n    let avatar=node.getavatar(t.nodex,t.nodey);\n    if(t.image&&(!avatar||\n      avatar!=t.avatar||t.scanned!=avatar.scanned)) \n        this.removeimage(t);\n    if(avatar&&avatar!=t.avatar) this.addimage(t,avatar);\n    if(avatar&&this.player.target==t.avatar){\n      t.classList.add('target');\n    }else t.classList.remove('target');\n  }\n  \n  disconnect(e){\n    if(!(e instanceof Disconnect)) return;\n    this.refresh(false);\n    alert(e.message);\n    this.showconsole=false;\n    this.map.innerHTML='';\n    this.console.innerHTML='';\n    deck.disconnect();\n    this.messaging.publish(new ShowView('CharacterScreen'));\n    if(e.win) this.messaging.publish(new ShowView('Win'));\n  }\n  \n  refresh(act=true){\n    try{\n      if(act) while(this.system.act()){ /* process NPCs */ }\n    }catch(e){\n      this.disconnect(e);\n      return;\n    }\n    this.printmessages();\n    if(this.system.revealed) for(let n of this.system.nodes) \n      this.placenode(n,false);\n    for(let t of this.tiles) this.refreshtile(t);\n    this.messaging.publish(new Refresh('ProgramBar'));\n  }\n}\n\nexport function refresh(){current.refresh();}\n","import {deck} from '../modules/deck';\nimport {getactive as getsystem} from '../modules/cyberspace/system';\nimport {console} from '../modules/cyberspace/console';\nimport {inject} from 'aurelia-framework';\nimport {BindingSignaler} from 'aurelia-templating-resources';\nimport {refresh as refreshcyberspace} from './infojack-cyberspace';\nimport {sound} from '../modules/sound';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {Refresh} from '../messages';\n\n@inject(BindingSignaler,EventAggregator)\nexport class ProgramBar{\n  constructor(BindingSignaler,EventAggregator) {\n    this.signals=BindingSignaler;\n    this.messaging=EventAggregator;\n    this.collapsed=true;\n    deck.sort();\n    let me=this;\n    this.messaging.subscribe(Refresh,function(r){\n      if(r.target=='ProgramBar') me.refreshdetails();\n    });\n  }\n  \n  attached(){this.refresh();}\n  \n  gethpcolor(hp){\n    let green=[124,252,0];\n    let red=[255,0,0];\n    let r=red[0]+hp*(green[0]-red[0]);\n    let g=red[1]+hp*(green[1]-red[1]);\n    let b=red[2]+hp*(green[2]-red[2]);\n    return 'rgb('+r+','+g+','+b+')';\n  }\n  \n  //not all data needs to be update every single turn\n  //prevent a cyberspace<->program bar refresh loop\n  refreshdetails(){\n    let c=this.system.player.character;\n    let hp=c.hp/c.maxhp;\n    this.hpcolor='color:'+this.gethpcolor(hp)+';';\n    this.hp=Math.round(100*hp);\n    this.load=deck.memoryused;\n    this.totalload=deck.memory;\n    let load=deck.getload();\n    if(load==0) this.loadcolor='white';\n    else if(load==1) this.loadcolor='orange';\n    else this.loadcolor='red';\n    this.loadcolor='color:'+this.loadcolor+';';\n    this.freestorage=deck.storage-deck.storageused;\n  }\n  \n  refresh(){\n    this.programs=deck.programs.slice();\n    this.system=getsystem();\n    this.refreshdetails();\n    refreshcyberspace();\n    this.signals.signal('update-program-bar');\n  }\n  \n  toggle(){this.collapsed=!this.collapsed;}\n  \n  isloaded(program){\n    return deck.loaded.indexOf(program)>=0;\n  }\n  \n  geticonclass(program){\n    return this.isloaded(program)?\"loaded\":\"unloaded\";\n  }\n  \n  doload(program){\n    let load=program.load(this.system);\n    if(load) sound.play(sound.LOAD);\n    this.refresh();\n    return load;\n  }\n  \n  dounload(program){\n    let unload=program.unload(this.system);\n    if(unload) sound.play(sound.UNLOAD);\n    this.refresh();\n    return unload;\n  }\n  \n  run(program){\n    //TODO skill roll\n    if(!this.isloaded(program)){\n      console.print('Load '+program.name+' first...');\n    }else if(program.run(this.system)){\n      //TODO duration callback and skill check\n    }\n    this.refresh();\n  }\n}\n","import {hero,costs} from '../modules/character/character';\nimport environment from '../environment';\n\n/* TODO add difficulty modes */\nexport class CharacterAbilities {\n    constructor() {}\n    \n    attached(){\n        this.full=environment.fullattributes;\n        this.strength=hero.strength;\n        this.dexterity=hero.dexterity;\n        this.constitution=hero.constitution;\n        this.intelligence=hero.intelligence;\n        this.wisdom=hero.wisdom;\n        this.charisma=hero.charisma;\n        this.pointbuy=hero.pointbuy;\n        this.pointextra=hero.pointextra;\n    }\n    \n    save(){\n        let clone={};\n        Object.assign(clone,this);\n        delete clone.full;\n        hero.assign(clone);\n    }\n\n    upgrade(ability){\n      let current=this[ability];\n      if(current==18) return;\n      let raised=this[ability]+1;\n      if(this.pointextra>0){\n        this.pointextra-=1;\n        this[ability]=raised;\n      }else if(this.buy(current)){\n        this[ability]=raised;\n      }else return;\n      this.save();\n      hero.updateranks(ability);\n    }\n    \n    buy(current){\n        let next=current+1;\n        let cost=costs[next]-costs[current];\n        if(this.pointbuy>=cost){\n            this.pointbuy-=cost;\n            return true;\n        }\n        return false;\n    }\n}\n","import {deck} from '../modules/deck';\nimport {hero,sign} from '../modules/character/character';\nimport {grades} from '../modules/grade';\n\n//TODO move to a city shop screen instead of character\nexport class CharacterDeck {\n    constructor(){}\n    \n    attached(){this.refresh();}\n    \n    refresh(){\n      this.memory=deck.memory;\n      this.storage=deck.storage;\n      this.name=hero.possess();\n      this.wealth=hero.wealth;\n      this.electronics=sign(hero.getelectronics());\n      this.deckgrade=deck.deckgrade;\n      this.memorygrade=deck.memorygrade;\n      this.storagegrade=deck.storagegrade;\n      this.stealthgrade=deck.stealthgrade;\n      this.canupgradedeck=deck.upgradedeck(false);\n      this.canupgradememory=deck.upgradememory(false);\n      this.canupgradestorage=deck.upgradestorage(false);\n      this.canupgradestealth=deck.upgradestealth(false);\n    }\n    \n    grade(i){return grades[i];}\n    \n    upgradedeck(){\n      debugger;\n      deck.upgradedeck(true);\n      this.refresh();\n    }\n    \n    upgradememory(){\n      deck.upgradememory(true);\n      this.refresh();\n    }\n    \n    upgradestorage(){\n      deck.upgradestorage(true);\n      this.refresh();\n    }\n    \n    upgradestealth(){\n      deck.upgradestealth(true);\n      this.refresh();\n    }\n}\n","import {hero,sign} from '../modules/character/character';\nimport {skills} from '../modules/character/skill';\nimport {Class} from '../modules/character/class/class';\n\nexport class CharacterDetails {\n    constructor() {\n      this.abilities=['Strength','Dexterity','Constitution','Intelligence','Wisdom','Charisma'];\n      this.saves=['Fortitude','Reflexes','Will'];\n      this.skills=skills;\n      this.classes=Class.classes;\n      this.hero=hero;\n    }\n\n    bind(){\n      this.avatar=hero.connect();\n    }\n    \n    getmodifier(ability){\n      ability=ability.toLowerCase();\n      ability=this.avatar.getmodifier(this.avatar[ability]);\n      return sign(ability);\n    }\n    \n    getsave(save){\n      save=save.toLowerCase();\n      return sign(this.avatar['get'+save]());\n    }\n    \n    getskill(skill){\n      skill=skill.name.replace(' ','').toLowerCase()\n      return sign(this.avatar['get'+skill]());\n    }\n    \n    sign(n){return sign(n);}\n}\n","import {feats} from '../modules/character/feat';\nimport {hero} from '../modules/character/character';\nimport {inject} from 'aurelia-framework';\nimport {BindingSignaler} from 'aurelia-templating-resources';\n\n@inject(BindingSignaler)\nexport class CharacterFeats {\n    constructor(BindingSignaler) {\n        this.signals=BindingSignaler;\n        this.viewname='Feats';\n    }\n    \n    bind(){this.points=hero.newfeats;}\n\n    add(feat){\n        if(this.points==0) return;\n        this.points-=1;\n        hero.newfeats-=1;\n        feat.apply(hero);\n        this.signals.signal('update');\n    }\n    \n    validate(feat){\n        return this.points>0&&feat.validate(hero);\n    }\n    \n    getcurrent(){\n      let current=[];\n      for(let f of hero.feats) if(!f.talent) current.push(f);\n      return current;\n    }\n    \n    getall(){return feats;}\n}\n","import {hero} from '../modules/character/character';\nimport environment from '../environment';\n\nexport class CharacterGeneral {\n    constructor() {\n      this.hero=hero;\n      this.avatar=hero.image;\n      this.avatars=environment.playeravatars;\n    }\n    \n    attached(){this.name.focus();}\n    \n    select(avatar){\n      this.avatar=avatar;\n      hero.image=avatar;\n    }\n}\n","import {PROGRAMS} from '../modules/program/program';\nimport {hero,sign} from '../modules/character/character';\nimport {deck} from '../modules/deck';\nimport {inject} from 'aurelia-framework';\nimport {BindingSignaler} from 'aurelia-templating-resources';\n\n//TODO move out of character screen\n@inject(BindingSignaler)\nexport class CharacterPrograms {\n    constructor(BindingSignaler) {\n      this.programs=PROGRAMS;\n      this.signals=BindingSignaler;\n    }\n    \n    attached(){this.refresh();}\n    \n    refresh(){\n      this.name=hero.possess();\n      this.wealth=hero.wealth;\n      this.technology=sign(hero.gettechnology());\n      this.signals.signal('update');\n    }\n    \n    has(program){return deck.programs.indexOf(program)>=0;}\n    \n    getpurchaselabel(program){\n      let wealth=program.purchasedc-10;\n      if(wealth<0) wealth=0;\n      return 'Requires '+wealth+'¥';\n    }\n    \n    canbuy(program){\n      return !this.has(program)&&\n        hero.wealth+10>=program.purchasedc;\n    }\n    \n    buy(program){\n      if(program.buy()) this.refresh();\n      else alert('Cannot buy error!');\n    }\n    \n    cancreate(program){\n      return !this.has(program)&&\n        hero.gettechnology()+10>=program.programmingdc;\n    }\n    \n    getprogramminglabel(program){\n      return 'Requires technology '+\n        sign(program.programmingdc-10);\n    }\n    \n    create(program){\n      deck.programs.push(program);\n      this.refresh();\n    }\n}\n","import {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {ShowView} from '../messages';\nimport {save} from '../modules/save';\n\n@inject(EventAggregator)\nexport class CharacterScreen {\n  constructor(messaging) {\n      this.messaging=messaging;\n      this.show=false;\n      this.showgeneral=true;\n      this.showabilities=false;\n      this.showskills=false;\n      this.showfeats=false;\n      this.showtalents=false;\n      this.showdetails=false;\n      this.showdeck=false;\n      this.showprograms=false;\n      let me=this;\n      messaging.subscribe(ShowView,function(show){\n          if(show.view=='CharacterScreen') me.show=true;\n      });\n  }\n  \n  select(e){\n    let id=e.target.id;\n    let buttons=\n      this.charactermenu.querySelectorAll('button');\n    for(let button of buttons){\n      let classes=button.classList;\n      if(!classes) continue;\n      var show=button.id==id;\n      this['show'+button.id.replace('character-','')]=show;\n      if(show){\n        classes.add('highlightbg');\n      } else {\n        classes.remove('highlightbg');\n      }\n    }\n  }\n  \n  close(){\n      save.save();\n      this.show=false;\n      this.messaging.publish(new ShowView('Cyberspace'));\n  }\n}\n\n","import {skills} from '../modules/character/skill';\nimport {hero} from '../modules/character/character';\nimport {inject} from 'aurelia-framework';\nimport environment from '../environment';\n\nexport class CharacterSkills {\n    constructor() {\n        this.skills=skills;\n    }\n    \n    bind(){\n        this.hero=hero;\n        this.ranks={};\n        for(let s of skills.values()) \n          this.ranks[s.name]=hero.getranks(s.name);\n    }\n    \n    iscrossclass(skill){\n        return environment.ccskills&&\n          !hero.classskills.includes(skill);\n    }\n    \n    buy(skill){\n        return this.iscrossclass(skill)?2:1;\n    }\n    \n    upgrade(skill){\n        if(!this.canupgrade(this.ranks[skill],skill)) return;\n        let cost=this.buy(skill);\n        hero.ranks-=cost;\n        this.ranks[skill]+=1;\n        hero.setranks(skill,this.ranks[skill]);\n        if(skill=='Profession'&&hero.level==1\n          &&this.ranks[skill]==1) hero.wealth+=1;\n    }\n    \n    canupgrade(value,skill){\n        let cost=this.buy(skill);\n        return hero.ranks>=cost && value<3+hero.level;\n    }\n    \n    getability(skill){\n      return skill.ability.substring(0,3).toUpperCase();\n    }\n}\n","import {useView} from 'aurelia-framework';\nimport {hero} from '../modules/character/character';\nimport {Class} from '../modules/character/class/class';\nimport {inject} from 'aurelia-framework';\nimport {BindingSignaler} from 'aurelia-templating-resources';\n\n@useView('./character-feats.html')\n@inject(BindingSignaler)\nexport class CharacterTalents {\n    constructor(BindingSignaler) {\n        this.signals=BindingSignaler;\n        this.viewname='Talents';\n    }\n    \n    bind(){\n      this.points=hero.talent;\n      this.talents=new Map();\n      for(let c in hero.classes)\n        for(let [name,talent] of Class.classes.get(c).talents)\n          this.talents.set(name,talent);\n    }\n\n    add(talent){\n        if(this.points==0) return;\n        this.points-=1;\n        hero.talent-=1;\n        talent.apply(hero);\n        this.signals.signal('update');\n    }\n    \n    validate(talent){\n        return this.points>0&&talent.validate(hero);\n    }\n    \n    getcurrent(){\n      let current=[];\n      for(let f of hero.feats) if(f.talent) current.push(f);\n      return current;\n    }\n    \n    getall(){return this.talents;}\n}\n","import {hero,sign} from './character/character'\nimport {grades as armor} from './program/armor';\nimport {grades as blaster} from './program/blaster';\n\nvar OK='';\nvar MEMORYUPGRADE=[+10,+5,+5,+5];\n\nclass Deck{\n  constructor(){\n    this.memory=10;\n    this.memoryused=0;\n    this.storage=20;\n    this.storageused=0;\n    this.deckgrade=1;\n    this.memorygrade=0;\n    this.storagegrade=0;\n    this.stealthgrade=0;\n    this.loaded=[];\n    this.programs=[];\n  }\n  \n  upgrade(checkgrade,currentgrade,purchasedc,installdc,\n    apply){\n      if(currentgrade==4)\n        return 'Already at maximum grade.';\n      let upgrade=currentgrade+1;\n      if(checkgrade&&upgrade>this.deckgrade) \n        return 'Requires a deck upgrade.';\n      purchasedc+=2*(upgrade-1);\n      if(hero.wealth<purchasedc-10) \n        return 'Requires '+(purchasedc-10)+'¥.';\n      installdc+=1*(upgrade-1);\n      if(hero.getelectronics()<installdc-10) \n        return 'Requires electronics '+sign(installdc-10)\n          +'.';\n      if(apply&&!hero.buy(purchasedc))\n        return 'Unexpected not buy error.';\n      return OK;\n  }\n  \n  upgradedeck(apply){\n    let result=this.upgrade(false,this.deckgrade,10,12,apply);\n    if(result==OK&&apply) this.deckgrade+=1;\n    return result;\n  }\n  \n  upgradememory(apply){\n    let result=\n      this.upgrade(true,this.memorygrade,9,14,apply);\n    if(result==OK&&apply){\n      this.memory+=MEMORYUPGRADE[this.memorygrade];\n      this.memorygrade+=1;\n    }\n    return result;\n  }\n  \n  upgradestorage(apply){\n    let result=\n      this.upgrade(true,this.storagegrade,8,14,apply);\n    if(result==OK&&apply){\n      this.storage+=10;\n      this.storagegrade+=1;\n    }\n    return result;\n  }\n  \n  upgradestealth(apply){\n    let result=\n      this.upgrade(true,this.stealthgrade,10,12,apply);\n    if(result==OK&&apply) this.stealthgrade+=1;\n    return result;\n  }\n  \n  assign(data){\n    for(let key in data){\n      if(key in this){\n        this[key]=data[key];\n      }\n    }\n  }\n  \n  sort(){\n    this.programs.sort((a,b)=>a.compare(b));\n    this.loaded.sort((a,b)=>a.compare(b));\n  }\n  \n  getload(){\n    let load=this.memoryused/this.memory;\n    if(load>=.75) return 2;\n    if(load>=.5) return 1;\n    return 0;\n  }\n  \n  connect(system){ //refresh effects for loaded programs\n    let loaded=this.loaded;\n    this.loaded=[];\n    for(let program of loaded){\n      program.load(system);\n    }\n  }\n  \n  getfreestorage(){return this.storage-this.storageused;}\n  \n  disconnect(){this.storageused=0;}\n}\n\nexport var deck=new Deck();\nfor(let program of [armor[0],blaster[0]]){\n  program.buy();\n  deck.loaded.push(program);\n}\n","export var grades=['0','I','II','III','IV','V','VI','VII',\n'VIII','IX','X','XI'];\n","export var CRITICALHIT=9001;\nexport var CRITICALMISS=-CRITICALHIT;\n\nclass Rpg{\n    constructor(){}\n    \n    r(min,max){\n      return Math.floor((Math.random()*(max+1))+min);\n    }\n    \n    d(dice,sides){\n        let sum=0;\n        for(let i=0;i<dice;i++){\n            sum+=this.r(1,sides);\n        }\n        return sum;\n    }\n    \n    choose(list){\n      return list[this.r(0,list.length-1)];\n    }\n    \n    chancein(n){\n      n=Math.floor(n);\n      return n>=1&&this.r(1,n)==1;\n    }\n    \n    shuffle(array){\n      for (let i=array.length-1;i>0;i--) {\n        let j=this.r(0,i);\n        let swap=array[i];\n        array[i]=array[j];\n        array[j]=swap;\n      }\n      return array;\n    }\n    \n    randomize(amount){\n      return this.r(1,amount)-this.r(1,amount);\n    }\n}\n\nexport var rpg=new Rpg();\n","import {hero} from './character/character';\nimport environment from '../environment';\nimport {deck} from './deck';\nimport {PROGRAMS} from './program/program';\n\nclass Save{\n  constructor(){}\n  \n  checkload(){\n    return localStorage.getItem('infojack-save');\n  }\n  \n  debug(){\n    if(!environment.printsave) return;\n    let data=this.checkload();\n    if(data) alert(data);\n  }\n\n  saveprograms(programs){\n    return programs.map(p=>p.name);\n  }\n  \n  save(){\n    let data={};\n    data.hero=hero;\n    data.deck=Object.assign({},deck);\n    data.deck.loaded=this.saveprograms(data.deck.loaded);\n    data.deck.programs=this.saveprograms(data.deck.programs);\n    localStorage.setItem('infojack-save',\n      JSON.stringify(data));\n    this.debug();\n  }\n\n  loadprograms(deck){\n    let programs=[];\n    let loaded=[];\n    for(let name of deck.programs){\n      let p=PROGRAMS.get(name);\n      programs.push(p);\n      if(deck.loaded.indexOf(name)>=0) loaded.push(p);\n    }\n    deck.programs=programs;\n    deck.loaded=loaded;\n  }\n  \n  populate(data){\n    hero.assign(data.hero);\n    deck.assign(data.deck);\n    this.loadprograms(deck);\n    this.debug();\n  }\n  \n  load(){\n    let data=this.checkload();\n    if(!data) return false;\n    data=JSON.parse(data);\n    this.populate(data);\n    this.initialize();\n    return true;\n  }\n\n  initialize(){}\n\n  clear(){localStorage.setItem('infojack-save','');}\n}\n\nexport var save=new Save();\n","var PREFIX='./sounds/';\n\nvar queue=[];\nvar running=false;\n\nclass Sound{\n  constructor(){\n    this.ALERTCANCEL='CancelAlert.wav';\n    this.ALERTRED='RedAlert.wav';\n    this.ALERTYELLOW='YellowAlert.wav';\n    this.ATTACK='9mmPistol.wav';\n    this.CONNECT='Dialup.wav';\n    this.CRASH='Spike.wav';\n    this.DISABLE='CancelAlert.wav';\n    this.DISCONNECTED='EndOfLine.wav';\n    this.ERROR='Computer Error Alert-SoundBible.com-783113881.mp3';\n    this.ICEATTACK='Pulse1.wav';\n    this.ICEENTER='ICEEnter.wav';\n    this.ICELEAVE='ICEEnter.wav';\n    this.LOAD='Misc2.wav';\n    this.MOVE='Move.wav';\n    this.SCAN='Ping.wav';\n    this.QUERY='ICELeave.wav';\n    this.UNLOAD='Misc5.wav';\n  }\n  \n  process(){\n    if(queue.length==0){\n      running=false;\n      return;\n    }\n    running=true;\n    let a=new Audio(queue.shift());\n    let me=this;\n    a.onended=function(){me.process();};\n    a.play();\n  }\n    \n  play(file){\n    file=PREFIX+file;\n    if(queue.indexOf(file)>=0) return;\n    queue.push(file);\n    if(!running) this.process();\n  }\n}\n\nexport var sound=new Sound();\n","export function configure(config) {\n  //config.globalResources([]);\n}\n","import {occupations} from './occupation';\nimport {webcrawler} from './class/webcrawler';\nimport {skills} from './skill';\nimport {feats} from './feat';\nimport {rpg} from '../rpg';\nimport environment from '../../environment';\n\nvar ABILITYPOINTS=\n  Math.round((15+4*6)/(environment.fullattributes?1:2));\n\nexport var costs={\n    7:-4,\n    8:-2,\n    9:-1,\n    10:0,\n    11:1,\n    12:2,\n    13:3,\n    14:5,\n    15:7,\n    16:10,\n    17:13,\n    18:17,\n}\n\nexport class Character{\n  constructor(name){\n    this.name=name;\n    this.image=rpg.r(0,environment.playeravatars-1);\n    this.hp=0;\n    this.maxhp=0;\n    this.strength=7;\n    this.dexterity=7;\n    this.constitution=7;\n    this.intelligence=7;\n    this.wisdom=7;\n    this.charisma=7;\n    this.pointbuy=ABILITYPOINTS;\n    this.pointextra=0;\n    this.wealth=5; //average of 2d4 to prevent scumming\n    if(environment.wealth) this.wealth=environment.wealth;\n    this.classskills=[];\n    this.classes={};//holds levels\n    this.level=0;\n    this.ranks=0;\n    this.bab=0;//hold only primary BAB\n    this.edgedice=[0,0];//0d1\n    this.edge=0;//current edge\n    this.fort=0;\n    this.ref=0;\n    this.will=0;\n    this.defence=0;\n    this.init=0;\n    this.speed=30;\n    this.talent=0;\n    if(environment.extratalents)\n      this.talent+=environment.extratalents;\n    this.contacts=0;//TODO\n    this.feats=[];\n    this.newfeats=2;\n    for(let s of skills.values()){\n      this[s.name.replace(' ','').toLowerCase()]=0;\n    }\n  }\n\n  assign(data){\n    for(let key in data){\n      if(key in this){\n        this[key]=data[key];\n      }\n    }\n  }\n  \n  setoccupation(occupation){\n      this.wealth+=occupation.wealth;\n      for(let s of occupation.skills){\n          this.addclassskill(s);\n      }\n  }\n  \n  addclassskill(s){\n      if(this.classskills.indexOf(s)<0){\n          this.classskills.push(s);\n      }\n  }\n  \n  connect(){\n    let avatar=new Character();\n    Object.assign(avatar,this);\n    if(this.classes['Webcrawler']){\n      this.enhancecrawler(avatar);\n    }\n    return avatar;\n  }\n  \n  enhancecrawler(avatar){\n    avatar.strength=Math.max(\n      avatar.strength,avatar.intelligence);\n    avatar.dexterity=Math.max(\n      avatar.dexterity,avatar.wisdom);\n    avatar.constitution=Math.max(\n      avatar.constitution,avatar.charisma);\n    for(let con=this.constitution+1;\n      con<=avatar.constitution;con++)\n        if(con%2==0) avatar.maxhp+=1;\n    avatar.hp=avatar.maxhp;\n    let level=this.classes['Webcrawler'];\n    avatar.bab-=[0,1,1,2,2,3,3,4,4,5][level-1];\n    avatar.bab+=level;\n  }\n  \n  getmodifier(ability){\n      if(ability%2==1){\n          ability-=1;\n      }\n      return (ability-10)/2;\n  }\n  \n  getranks(name){\n      return this[name.replace(' ','').toLowerCase()];\n  }\n  \n  setranks(name,value){\n      this[name.replace(' ','').toLowerCase()]=value;\n  }\n  \n  hasfeat(f){\n      f=f.name||f;\n      for(let feat of this.feats)\n        if(feat.name.toLowerCase()==f.toLowerCase())\n          return feat;\n      return false;\n  }\n  \n  addfeat(f){this.feats.push(f);}\n  \n  getskill(ranks,ability,feat,featbonus){\n      if(feat&&this.hasfeat(feat)) ranks+=featbonus;\n      ranks=ranks+this.getmodifier(ability);\n      return ranks;\n  }\n  \n  getbluff(){\n    return this.getskill(this.bluff,this.charisma,'power of belief',1);\n  }\n  \n  getconcentration(){\n      return this.getskill(\n        this.concentration,this.constitution,false,0);\n  }\n  \n  getdecryption(){\n    let decryption=this.getskill(\n      this.decryption,this.intelligence,'studious',2);\n    if(this.hasfeat('power of belief')) decryption+=1;\n    return decryption;\n  }\n  \n  getelectronics(){\n      return this.getskill(\n        this.electronics,this.intelligence,false,0);\n  }\n  \n  getforgery(){\n      return this.getskill(\n        this.forgery,this.intelligence,'meticulous',2);\n  }\n  \n  getinformation(){\n      return this.getskill(\n        this.information,this.charisma,'trustworthy',3);\n  }\n  \n  gethacking(){\n      return this.getskill(\n        this.hacking,this.intelligence,\n        'specialized equipment',1);\n  }\n  \n  getperceive(){\n      return this.getskill(\n        this.perceive,this.wisdom,false,0);\n  }\n  \n  getmedicine(){\n      return this.getskill(\n        this.medicine,this.wisdom,false,0);\n  }\n  \n  getstealth(){\n    let stealth=this.getskill(\n      this.stealth,this.dexterity,'stealthy',3);\n    if(this.hasfeat('power of belief')) stealth+=1;\n    return stealth;\n  }\n  \n  getprofession(){\n    return this.getskill(\n      this.profession,this.wisdom,false,0);\n  }\n  \n  getresearch(){\n      return this.getskill(\n        this.research,this.intelligence,'studious',2);\n  }\n  \n  getsearch(){\n    let search=this.getskill(\n      this.search,this.intelligence,'meticulous',2);\n    if(this.hasfeat('power of belief')) search+=1;\n    return search;\n  }\n  \n  gettechnology(){\n      return this.getskill(\n        this.technology,this.intelligence,'educated',3);\n  }\n  \n  getfortitude(){\n    return this.fort+this.getmodifier(this.constitution);\n  }\n  \n  getreflexes(){\n    return this.ref+this.getmodifier(this.dexterity);\n  }\n  \n  getwill(){\n    return this.will+this.getmodifier(this.wisdom);\n  }\n  \n  getinitiative(){\n    let init=this.init+this.getmodifier(this.dexterity);\n    if(this.hasfeat('improved initiative')) init+=4;\n    return init;\n  }\n  \n  getdefence(){\n    return 10+this.defence+this.getmodifier(this.dexterity);\n  }\n  \n  getmelee(){\n    return this.bab+this.getmodifier(this.strength);\n  }\n  \n  getranged(){\n    return this.bab+this.getmodifier(this.dexterity);\n  }\n  \n  price(purchasedc){\n    let price=purchasedc>=15?1:0;\n    let difference=purchasedc-this.wealth;\n    if(difference<1) return price;\n    if(difference<=10) return price+1;\n    price+=difference-10;\n    return price>12?12:price; \n  }\n  \n  /*TODO gather information takes 1 hour per purchasedc\n    * use this to find items of interest (1 store per type of buy: programs, deck, cyber) and create as many options until the total purchasedc is equal or bigger than 16 in a day (or 24h with manual sleeping/tired routines). Each gather information roll returns the maximum purchasedc of the found object (or manybe result-10).\n    * */\n  buy(purchasedc){\n    if(10+this.wealth<purchasedc) return false;\n    this.wealth-=this.price(purchasedc);\n    if(this.wealth<0) this.wealth=0;\n    return true;\n  }\n  \n  sell(purchasedc){ /*-3 for selling, -3 for illegal*/\n    let price=this.price(purchasedc-3-3);\n    this.wealth+=price;\n    return price;\n  }\n  \n  /* As per level-up rules, in Infojack may be used to\n    * represent mission payment values or similar. TODO */\n  upgradewealth(){\n    let taketen=10+this.getprofession();\n    if(taketen<this.wealth) return 0;\n    let wealth=1;\n    taketen-=this.wealth;\n    while(taketen>=5){\n      wealth+=1;\n      taketen-=5;\n    }\n    return wealth;\n  }\n  \n  possess(){\n    let letter=this.name[this.name.length-1].toLowerCase();\n    let name=this.name+\"'\";\n    if(letter!='s') name+='s';\n    return name;\n  }\n  \n  move(){return .5*30/this.speed;}\n  \n  updateranks(ability){//call after adding 1 ability point\n    if(ability=='intelligence'&&this[ability]%2==0)\n      this.ranks+=this.level==1?4:1;\n  }\n  \n  learnskill(skill){\n    if(this[skill]===undefined)\n      throw 'Unknown skill '+skill;\n    while(this[skill]<this.level+3&&this.ranks>0){\n      this[skill]+=1;\n      this.ranks-=1;\n    }\n  }\n  \n  learnability(ability){\n    if(this.ranks==0)\n      console.log('Learn skills after abilities!');\n    if(this[ability]===undefined)\n      throw 'Unknown ability '+ability;\n    while(this.pointextra>0){\n      this[ability]+=1;\n      this.pointextra-=1;\n      this.ugpraderanks(ability);\n    }\n  }\n  \n  learnfeat(name){\n    let feat=feats.get(name.toLowerCase());\n    if(!feat) throw 'Unkwnon feat: '+name;\n    if(this.newfeats==0) return false;\n    if(!feat.validate(this)) throw 'Invalid feat: '+name;\n    this.addfeat(feat);\n  }\n  \n  levelup(){\n    if(this.level==10) return false; //TODO\n    webcrawler.advance(hero);\n    return true;\n  }\n}\n\nexport function sign(n){return n>=0?'+'+n:n;}\n\nexport var hero=new Character('Player1');\nhero.setoccupation(occupations.adventurer);\nhero.levelup(); //becomes level 1\nhero.buy(10);//basic deck\n//TODO ideal program list: flicker,blade,cloak\n","export var feats=new Map();\n\nexport class Feat{\n    constructor(name,description){\n        this.name=name;\n        this.description=description;\n        this.talent=false;\n    }\n    \n    validate(character){\n        return !character.hasfeat(this);\n    }\n    \n    apply(character){\n        character.addfeat(this);\n    }\n}\n\nexport class Talent extends Feat{\n  constructor(name,description){\n    super(name,description);\n    this.talent=true;\n  }\n}\n\nclass Educated extends Feat{\n    constructor(){\n        super('Educated','+3 to Techonology rolls');\n    }\n}\n\nclass Meticulous extends Feat{\n    constructor(){\n        super('Meticulous','+2 to Forgery and Search rolls');\n    }\n}\n\nclass Stealthy extends Feat{\n    constructor(){\n        super('Stealthy','+3 to Stealth rolls');\n    }\n}\n\nclass Studious extends Feat{\n    constructor(){\n        super('Studious','+2 to Decrypt and Research rolls');\n    }\n}\n\nclass Trustworthy extends Feat{\n    constructor(){\n        super('Trustworthy','+3 to Information rolls');\n    }\n}\n\nclass ImprovedInitiative extends Feat{\n   constructor(){\n        super('Improved initiative',\n              '+4 to initiative rolls');\n    }\n}\n\nclass Windfall extends Feat{\n   constructor(){\n        super('Windfall',\n          '+3 wealth (may be taken multiple times)');\n    }\n    validate(character){return true;}\n    apply(character){character.wealth+=3;}\n}\n\nfor(let feat of [\n    new Educated(),\n    new ImprovedInitiative(),\n    new Meticulous(),\n    new Stealthy(),\n    new Stealthy(),\n    new Studious(),\n    new Trustworthy(),\n    new Windfall(),\n]) feats.set(feat.name.toLowerCase(),feat);\n","import {skills,checkskills} from './skill';\n\nclass Occupation{\n  constructor(wealth,skillsp){\n    this.wealth=wealth;\n    this.skills=skillsp;\n    checkskills(skillsp);\n  }\n}\n\nexport var occupations={};\n\n//adventurer gives you a choice of Feat but none of them are easy to add to the game. Maybe pick other occupation?\noccupations.adventurer=new Occupation(+1,['Bluff','Technology','Stealth','Perceive','Medicine']);\n","/*A couple skills here are cross-class but they're too few to bother enforcing the rules properly. Also the Adventurer occupation gives you 2 extra skills from a list to use as cross class. Those skill aren't there but it evens out anyway since that isn't being taken into account currently.\n \nCross skills are actually implemented on character-abilities.html but disabled.*/\n\nclass Skill{\n    constructor(name,ability,description){\n        this.name=name;\n        this.ability=ability; //used only as a label\n        this.description=description;\n    }\n}\n\nexport var skills=new Map();\n\nfor (let skill of [\n    new Skill('Bluff','Charisma',\n        \"Convince ICE you're not an intruder\"),\n    new Skill('Concentration','Constitution',\n        \"Focus your mind while in danger\"),\n    new Skill('Decryption','Intelligence',\n        \"Break into protected data\"),\n    new Skill('Electronics','Intelligence',\n        \"Build and install hardware\"),\n    new Skill('Forgery','Intelligence',\n        \"Forge authentication credentials\"),\n    new Skill('Hacking','Intelligence',\n        \"Act on the Web\"),\n    new Skill('Information','Charisma',\n        \"Find more shopping items and missions\"),\n    new Skill('Medicine','Wisdom',\n        \"Treat your injuries\"),\n    new Skill('Perceive','Wisdom',\n        \"Passive node scanning.\"),\n    new Skill('Profession','Wisdom',\n        \"Earn more money per contract\"),\n    new Skill('Research','Intelligence',\n        \"Do perimeter checks on Frames\"),\n    new Skill('Search','Intelligence',\n        \"Active node scanning.\"),\n    new Skill('Stealth','Dexterity',\n        \"Avoid being detected on the Web\"),\n    new Skill('Technology','Intelligence',\n        \"Create your own programs\"),\n]){\n    skills.set(skill.name,skill);\n}\n\nexport function checkskills(ss){\n    for(let s of ss) if(!skills.get(s)) alert('Unknown skill: '+s);\n    return ss;\n}\n","class Message{\n  constructor(text,system){\n    this.text=text;\n    this.alert=system.alert;\n  }\n}\n\nclass Console{\n  constructor(){\n    this.messages=[];\n    this.system=false;\n  }\n  \n  print(message){\n    if(!this.system) throw 'System not set';\n    this.messages.push(\n      new Message(message,this.system));\n  }\n  \n  next(){\n    return this.messages.shift();\n  }\n  \n  log(...args){window.console.log(args);}\n}\n\nexport var console=new Console();\n","import {rpg} from '../rpg';\nimport {Node} from './node/node';\nimport {Datastore} from './node/datastore';\nimport {Cpu} from './node/cpu';\nimport {Portal} from './node/portal';\nimport {Interface} from './node/interface';\nimport environment from '../../environment';\nimport {Scout} from './avatar/ice/scout';\nimport {console} from './console';\nimport {sound} from '../sound';\n\nvar active=false;\n\nexport class System{\n  constructor(level){\n    this.revealed=false; //reveal all map\n    this.level=level;\n    if(this.level<1) this.level=1;\n    else if(this.level>20) this.level=20;\n    this.alert=0;\n    this.nodes=[];\n    this.ice=[];\n    this.reentry=[];\n    this.entrance=null;\n    this.generatemap();\n    this.definenodes();\n    for(let n of this.nodes) n.generate();\n    this.generateice();\n    this.player=false; //set by Player\n    this.debug();\n  }\n  \n  debug(){\n    if(environment.revealmap) this.reveal();\n    if(environment.scannodes) for(let n of this.nodes)\n      for(let a of n.avatars.slice()){\n        a.scan();\n        a.scanned=true;\n      }\n  }\n  \n  getnode(x,y){\n    for(let n of this.nodes) if(x==n.x&&y==n.y) return n;\n    return null;\n  }\n  \n  generatemap(){\n    this.nodes.push(new Cpu(0,0,this));\n    let size=rpg.r(3,7)+this.level;\n    let leastx=0;\n    let leasty=0;\n    while(this.nodes.length<size){\n      let n=rpg.choose(this.nodes);\n      let x=n.x;\n      let y=n.y;\n      if(rpg.chancein(2)) x+=rpg.chancein(2)?+1:-1;\n      else y+=rpg.chancein(2)?+1:-1;\n      if(this.getnode(x,y)) continue;\n      this.nodes.push(new Node(x,y,this));\n      if(x<leastx) leastx=x;\n      if(y<leasty) leasty=y;\n    }\n    for(let n of this.nodes){ //ensure node.x>=0 node.y>=0\n      n.x-=leastx;\n      n.y-=leasty;\n    }\n  }\n  \n  replacenode(target,i){\n    let original=this.nodes[i];\n    target.id=original.id;\n    target.x=original.x;\n    target.y=original.y;\n    this.nodes[i]=target;\n  }\n  \n  findentrance(neighbors){\n    let portals=this.nodes.filter(\n      n=>n.id!=0&&n.getneighbors().length==neighbors); \n    if(portals.length==0) return -1;\n    return this.nodes.indexOf(rpg.choose(portals));\n  }\n  \n  generatenode(){\n    if(rpg.chancein(10)) return new Cpu(-1,-1,this);\n    if(rpg.chancein(4)) return new Interface(-1,-1,this);\n    return new Datastore(-1,-1,this);\n  }\n  \n  definenodes(){\n    this.nodes[0].setmain();\n    let entrancei=-1;\n    for(let neighbors=1;entrancei==-1;neighbors++){\n      entrancei=this.findentrance(neighbors);\n    }\n    this.entrance=new Portal(-1,-1,this);\n    this.replacenode(this.entrance,entrancei);\n    for(let i=1;i<this.nodes.length;i++){\n      if(i==entrancei) continue;\n      let neighbors=this.nodes[i].getneighbors().length;\n      let corridor=neighbors>1&&rpg.chancein(6-neighbors);\n      if(corridor) continue;\n      this.replacenode(this.generatenode(),i);\n    }\n  }\n  \n  reveal(){\n    this.revealed=true;\n    for(let n of this.nodes) n.visited=true;\n  }\n  \n  raisealert(raise=+1){\n    let previous=this.alert;\n    this.alert+=raise;\n    if(this.alert>2) this.alert=2;\n    else if (this.alert<0) this.alert=0;\n    if(this.alert==previous) return;\n    if(this.alert==0)\n      console.print('The alert is cleared.');\n    else if(this.alert==1){\n      console.print('The system is now in yellow alert...');\n      if(this.alert>previous) sound.play(sound.ALERTYELLOW);\n    }else{\n      console.print('The system is now in red alert!');\n      this.player.credentials=-1;\n      if(this.alert>previous) sound.play(sound.ALERTRED);\n    }\n    if(this.alert<previous) sound.play(sound.ALERTCANCEL);\n  }\n  \n  generateice(){\n    if(environment.noice) return;\n    let s=new Scout(this);\n    this.ice.push(s);\n    s.enter(this.nodes[0]);\n  }\n  \n  act(){ //return false when it's the player's turn\n    let next=this.player;\n    for(let n of this.nodes) for(let a of n.avatars)\n      if(a.ap<next.ap) next=a;\n    if(next==this.player) return false;\n    next.act();\n    return true;\n  }\n}\n\nexport function setactive(s){active=s;}\nexport function getactive(){return active;}\n","import {Program,SESSION,PROGRAMS} from './program';\nimport {console} from '../cyberspace/console';\n\nclass Armor extends Program{\n  constructor(grade){\n    super('Armor',grade,'armor.png',1,4,10,20);\n    this.duration=SESSION;\n    this.defence=+4+(grade-1);\n  }\n  \n  modify(bonus,player){\n    player.character.defence+=bonus;\n    console.print('Your defence is now '+\n      player.character.getdefence()+'.');\n  }\n  \n  load(system){\n    if(!super.load(system)) return false;\n    this.modify(this.defence,system.player);\n    return true;\n  }\n  \n  unload(system){\n    if(!super.unload(system)) return false;\n    this.modify(-this.defence,system.player);\n    return true;\n  }\n  \n  describe(){\n    return 'Adds +'+this.defence+' to defence';\n  }\n  \n  run(system){console.print(\"Armor is already active.\");}\n}\n\nexport var grades=[];\n\nfor(let armor=+4;armor<=+10;armor++)\n  grades.push(new Armor(armor-3));\n","import {Program} from './program';\nimport {console} from '../cyberspace/console';\nimport {rpg} from '../rpg';\nimport {sound} from '../sound';\n\nclass Blaster extends Program{\n  constructor(grade){\n    super('Blaster',grade,'blaster.png',2,5,10,20);\n    this.duration=10;\n    this.bonus=grade-1;\n  }\n  \n  run(system){\n    let p=system.player;\n    if(!p.target){\n      console.print('Select a target first...');\n      return;\n    }\n    system.player.ap+=this.apcost;\n    sound.play(sound.ATTACK);\n    let damage=rpg.r(1,6)+this.bonus;\n    if(!p.attack(p.character.getranged(),p.target,damage)){\n      console.print('You miss...');\n    }\n    system.raisealert(2);\n  }\n  \n  describe(){\n    return 'Deals 1d6+'+this.bonus+' damage (raises alarm)';\n  }\n}\n\nexport var grades=[];\n\nfor(let grade=1;grade<=11;grade++)\n  grades.push(new Blaster(grade));\n","import {deck} from '../deck';\nimport {grades} from '../grade';\nimport {console} from '../cyberspace/console';\nimport {hero} from '../character/character';\n\nexport var SESSION=Number.MAX_SAFE_INTEGER;\nexport var PROGRAMS=new Map();\n\nexport class Program{\n  constructor(name,grade,image,size,hack,buy,code){\n    this.hackingdc=hack;\n    this.purchasedc=buy;\n    this.programmingdc=code;\n    this.size=size; //MBs / blocks\n    this.apcost=.5;\n    this.duration=0; //0=instantaneous SESSION=permanent\n    this.basename=name;\n    this.name=name;\n    this.image='../../images/software/'+image;\n    this.grade=grade;\n    if(grade){\n      this.name+=' '+grades[grade];\n      if(grade>1) this.upgrade(grade-1);\n    }\n    PROGRAMS.set(this.name,this);\n  }\n  \n  upgrade(ntimes){\n    this.hackingdc+=ntimes;\n    this.purchasedc+=ntimes;\n    this.programmingdc+=ntimes;\n    this.size+=ntimes/2;\n  }\n  \n  describe(){return this.name;}\n  \n  conflict(program){return this.basename==program.basename;}\n  \n  load(system){\n    for(let program of deck.loaded) \n      if(this.conflict(program)){\n        console.print(\n          'You cannot load '+this.name+' while '+\n            program.name+' is loaded...');\n        return false;\n      }\n    if(deck.memoryused+this.size>deck.memory){\n      console.print(\n        'This program requires '+this.size+' free blocks.');\n      return false;\n    }\n    deck.memoryused+=this.size;\n    deck.loaded.push(this);\n    system.player.ap+=this.apcost;\n    return true;\n  }\n  \n  unload(system){\n    let i=deck.loaded.indexOf(this);\n    if(i<0) return false;\n    deck.memoryused-=this.size;\n    deck.loaded.splice(i,1);\n    return true;\n  }\n  \n  run(system){}\n  \n  compare(program){\n    if(this.basename==program.basename)\n      return this.grade-program.grade;\n    return this.basename.localeCompare(program.basename);\n  }\n  \n  buy(){\n    if(!hero.buy(this.purchasedc)) return false;\n    deck.programs.push(this);\n    return true;\n  }\n}\n","/* TODO \n * - for advanced classes, have edge dice as part of levelup\n */\n\nimport {checkskills} from '../skill';\nimport {rpg} from '../../rpg';\nimport {webcrawler} from './webcrawler';\n\nexport class Class{\n    constructor(){this.talents=new Map();}\n    \n    advance(character){\n        let level=character.classes[this.name];\n        if(!level) level=0;\n        level+=1;\n        if(level>10) {\n            throw 'Cannot advance past level 10!';\n        }\n        character.level+=1;\n        this.levelup(character,level);\n        character.classes[this.name]=level;\n    }\n    \n    upgradehp(character){\n      if(character.level==1){\n          character.maxhp=this.hd;\n          character.hp=character.maxhp;\n      }else{\n          let hp=Math.round((1+this.hd)/2);\n          character.maxhp+=hp;\n          character.hp+=hp;\n      }\n    }\n    \n    upgraderanks(character,classlevel){\n      let ranks=this.ranks+\n        character.getmodifier(character.intelligence);\n      character.ranks+=Math.max(1,ranks);\n      if(character.level==1) character.ranks*=4;\n      if(classlevel==1) for(let s of this.skills)\n        character.addclassskill(s);\n    }\n    \n    levelup(character,classlevel){\n      for(let stat of ['bab','fort','ref','will','defence'])\n        this.upgradestat(classlevel,stat,character);\n      this.upgradeedgedice(classlevel,character);\n      this.upgradereputation(character,classlevel);\n      this.upgradehp(character);\n      this.upgraderanks(character,classlevel);\n      if(character.level%3==0) character.newfeats+=1;\n      if(character.level%4==0) character.pointextra+=1;\n      //TODO may want to do this through external means to make it explicit to the player (as mission payment rates for example):\n      if(character.level>1) character.upgradewealth(); \n    }\n    \n    upgradestat(level,stat,character){\n        let last=level>1?this[stat][level-2]:0;\n        let current=this[stat][level-1];\n        character[stat]+=current-last;\n    }\n    \n    upgradeedgedice(level,character){\n        let target=this.edgedice[level-1].split('d');\n        target=[parseInt(target[0]),parseInt(target[1])];\n        if(target[0]>character.edgedice[0]||\n          (target[0]==character.edgedice[0]&&\n            target[1]>=character.edgedice[1]))\n              character.edgedice[0]=target[0];\n              character.edgedice[1]=target[1];\n        if(character.level==1) \n          character.edge+=character.edgedice[0];\n    }\n    \n    upgradereputation(character,level){\n        if(level==1){\n            if(this.reputation[0]>0){\n                //TODO boost\n            }\n        }else if(this.reputation[level-1]>\n                this.reputation[level-2]){\n            //TODO boost\n        }\n    }\n    \n    check(skills){\n      return checkskills(skills);\n    }\n}\n\nClass.classes=new Map();\n","import {Talent} from '../feat'; \nimport {Class} from './class'; \n\nclass TheWebIsAlive extends Talent{\n  constructor(){\n    super('The web is alive',\n      'Adds Will to Perception rolls (requires level 3 and Power of Belief)');\n  }\n  \n  validate(character){\n    return super.validate(character)&&\n      character.level>=3&&\n      character.hasfeat('power of belief');\n  }\n}\n\nclass SpecializedEquipment extends Talent{\n  constructor(){\n    super('Specialized equipment',\n      '+1 to hacking rolls, +5 speed, safe disconnections (requires 4 in hacking, electronics and technology)');\n  }\n  \n  validate(character){\n    return super.validate(character)\n      &&character.hacking>=4\n      &&character.electronics>=4\n      &&character.technology>=4;\n  }\n  \n  apply(character){\n    super.apply(character);\n    character.speed+=5;\n  }\n}\n\nclass Webcrawler extends Class{\n    constructor(){\n        super();\n        this.name='Webcrawler';\n        this.skills=this.check(['Hacking', 'Electronics', 'Decryption', /*'Disable device',*/ 'Forgery', 'Technology', 'Profession', 'Research', 'Technology', 'Search']);\n        this.hd=4;\n        this.ranks=7;\n        this.bab=[0,1,1,2,2,3,3,4,4,5];\n        this.fort=[0,0,1,1,1,2,2,2,3,3];\n        this.ref=[1,2,2,2,3,3,4,4,4,5];\n        this.will=[1,2,2,2,3,3,4,4,4,5];\n        this.defence=[1,1,2,2,2,3,3,3,4,4];\n        this.reputation=[0,1,1,2,2,3,3,4,4,5];\n        this.edgedice=['1d4','1d4','2d4','2d6','2d6','3d6','3d8','3d8','4d8','4d10'];\n        let talents=[\n          new Talent('Hackmastery',\n            '+2 to all damage inflicted'),\n          new Talent('Phreakmastery',\n            'Safe connections, +1 against traces'),\n          new Talent('Power of belief',\n            '+1 to bluff, decryption, search and stealth'),\n          new SpecializedEquipment(),\n          new TheWebIsAlive(),\n          ];\n        for(let t of talents)\n          this.talents.set(t.name,t);\n    }\n    \n    levelup(character,classlevel){\n        super.levelup(character,classlevel);\n        let level=character.level;\n        if(level==1||level==3||level==6||level==9){\n            character.talent+=1;\n        }else if(level==4||level==7){\n            character.ranks+=1;\n        }else if(level==5||level==8){\n            character.contacts+=1;\n        }else if(level==10){\n            character.wealth+=5;\n            //TODO +5 reputation to law and hackers\n        }\n    }\n}\n\nexport var webcrawler=new Webcrawler();\nClass.classes.set(webcrawler.name,webcrawler);\n","import {Avatar} from './avatar';\nimport {console} from '../console';\nimport {CRITICALMISS} from '../../rpg';\n\nexport class Alarm extends Avatar{//TODO create character with proper skill to disable\n  scan(){\n    this.setimage('nodes/alarm.bmp');\n    this.setname('Alarm');\n  }\n  \n  click(){\n    if(this.system.alert==0)\n      console.print('No alerts to clear right now...');\n    else if(this.hack(true)) this.system.raisealert(-2);\n  }\n}\n","import {rpg,CRITICALMISS} from '../../rpg';\nimport {console} from '../console';\nimport {Character} from '../../character/character';\nimport {webcrawler} from '../../character/class/webcrawler';\nimport {occupations} from '../../character/occupation';\nimport {sound} from '../../sound';\n\nexport class Avatar{\n  constructor(system){\n    this.obfuscate();\n    this.system=system;\n    this.node=null;\n    this.x=-1;\n    this.y=-1;\n    this.create(webcrawler,occupations.adventurer,\n      system.level);\n    this.scandc=this.system.level+rpg.randomize(4);\n    let stealth=10+this.character.getstealth();\n    this.scandc=Math.max(this.scandc,stealth,1);\n    this.ap=-this.rollinitiative();\n  }\n  \n  rollinitiative(){\n    return (rpg.r(1,20)+this.character.getinitiative())/20;\n  }\n  \n  obfuscate(){\n    this.setname('A process');\n    this.setimage('nodes/process.png');\n    this.scanned=false;\n  }\n  \n  create(characterclass,occupation,level){\n    this.character=new Character();\n    this.character.setoccupation(occupation);\n    for(let i=0;i<level;i++) \n      characterclass.advance(this.character);\n  }\n  \n  setname(name){\n    this.name=name;\n    this.tooltip=name;\n  }\n  \n  setimage(image){this.image='./images/'+image;}\n\n  enter(node){return node.enter(this);}\n  \n  click(){alert('Unimplemented.');}\n  \n  scan(){return true;}\n  \n  act(){this.ap+=.5;}\n  \n  describehealth(){\n    let health=this.character.hp/this.character.maxhp;\n    if(health<=0) return 'deallocated';\n    if(health==1) return 'unharmed';\n    if(health>=.5) return 'OK';\n    if(health>=.25) return 'unstable';\n    return 'critical';\n  }\n  \n  die(){this.leave(this.node);}\n  \n  damage(damage){\n    this.character.hp-=damage;\n    console.print(\n      this.name+' is '+this.describehealth()+'.');\n    if(this.character.hp<=0) this.die();\n  }\n  \n  hit(roll,bonus){\n    if(roll==1) return false;\n    if(roll==20) return true;\n    return roll+bonus>=this.character.getdefence();\n  }\n\n  //return true on hit\n  attack(bonus,target,damage,roll=false){\n    if(!roll) roll=rpg.r(1,20);\n    if(!target.hit(roll,bonus)) return false;\n    target.damage(damage);\n    return true;\n  }\n  \n  authenticate(hackingroll){\n    let p=this.system.player;\n    let querydc=10+this.character.getbluff();\n    if(hackingroll==CRITICALMISS||\n      (!p.hide(this)&&!p.query(querydc,this))){\n        this.system.raisealert(+1);\n        return false;\n    }\n    return true;\n  }\n  \n  hack(authenticate=false,hacking=false){\n    let p=this.system.player;\n    p.ap+=1;\n    let c=p.character;\n    if(!hacking) hacking=p.roll(c.gethacking());\n    let hackingdc=this.character.getdefence();\n    if((!authenticate||this.authenticate(hacking))&&\n      hacking<hackingdc) return true;\n    let name=this.name.toLowerCase();\n    sound.play(sound.ERROR);\n    console.print('You fail to hack: '+name+'...');\n    return false;\n  }\n  \n  leave(node){node.remove(this);}\n  \n  getserial(){\n    let serial=Number(rpg.r(0,9999)).toString();\n    while(serial.length<4) serial='0'+serial;\n    return serial;\n  }\n  \n  getscale(){ //a die size scaled to this level (d4 to d20)\n    let level=Math.min(20,this.character.level);\n    for(let die of [4,6,8,10,12,20]) if(level<=die)\n      return die;\n    throw 'Unknown damage level';\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Backdoor extends Avatar{\n  scan(){\n    this.setimage('nodes/backdoor.bmp');\n    this.setname('Backdoor');\n  }\n}\n","import {Avatar} from './avatar';\nimport {rpg} from '../../rpg';\n\nvar OUTCOMES=2;\n\nexport class Control extends Avatar{\n  constructor(system){\n    super(system);\n    this.memory=rpg.chancein(OUTCOMES);\n    this.privilege=rpg.chancein(OUTCOMES);\n  }\n  \n  scan(){\n    if(!this.memory&&!this.privilege) this.leave(this.node);\n    this.setimage('nodes/control.png');\n    this.setname('External device');\n  }\n}\n","import {Avatar} from './avatar';\nimport {rpg} from '../../rpg';\nimport envinronment from '../../../environment';\nimport {sound} from '../../sound';\nimport {console} from '../console';\n\nexport class Entry extends Avatar{\n  create(characterclass,occupation,level){\n    super.create(characterclass,occupation,level);\n    let c=this.character;\n    for(let s of ['bluff','perceive']) c.learnskill(s);\n  }\n  \n  scan(){\n    this.setimage('nodes/entry.png');\n    this.setname('ICE entry');\n  }\n  \n  click(){\n    if(this.hack(true)){\n      console.print('You disable the ICE re-entry point!');\n      sound.play(sound.DISABLE);\n      this.leave(this.node);\n    }\n  }\n  \n  act(){\n    this.ap+=1;\n    if(this.system.reentry.length==0) return;\n    let ice=this.system.reentry[0];\n    if(rpg.r(1,20)+this.system.level<10+ice.character.level)\n      return;\n    if(!ice.enter(this.node)) return;\n    ice=this.system.reentry.shift();\n    ice.character.hp=ice.character.maxhp;\n    ice.ap=this.ap-ice.rollinitiative();\n    ice.obfuscate();\n    if(envinronment.scannodes){\n      ice.scan();\n      ice.scanned=true;\n    }\n  }\n}\n","import {Avatar} from './avatar';\nimport {rpg,CRITICALMISS} from '../../rpg';\nimport {console} from '../console';\nimport {hero as offlinehero} from '../../character/character';\nimport {deck} from '../../deck';\n\nvar NOTDOWNLOADING=-1;\n\n//TODO would be great to have a filename generator based on the grade of the file\n//TODO have a chance of it being a program! (purchasedc==purchasedc)\nexport class File extends Avatar{\n  constructor(system){\n    super(system);\n    this.setname('Data');\n    this.setimage('nodes/fileunscanned.png');\n    this.purchasedc=system.level+rpg.randomize(4);\n    this.worthless=\n      this.purchasedc<1||rpg.chancein(system.level+1);\n    this.trap=!this.worthless&&\n      rpg.chancein(60/system.level);\n    this.protected=!this.worthless&&!this.trap&&\n      rpg.chancein(21/system.level);\n    if(this.worthless) this.purchasedc=0;\n    else if(this.protected&&this.purchasedc<system.level) \n      this.purchasedc=system.level;\n    this.size=rpg.r(1,this.getscale());\n    this.downloading=NOTDOWNLOADING;\n  }\n  \n  scan(){\n    this.scanned=true; //redundant (for File#setname)\n    if(this.worthless){\n      this.leave(this.node);\n    }else if(this.protected){\n      this.setimage('nodes/fileprotected.png');\n      this.setname('Encrypted data');\n    }else if(this.trap&&false){ //TODO only show if player has a verification program running (plus test)\n      this.setimage('nodes/filetrap.png');\n      this.setname('Trap data');\n    }else{\n      this.setimage('nodes/file.png');\n      this.setname('Unencrypted data');\n    }\n  }\n  \n  decrypt(){\n    if(!this.protected) return true;\n    let p=this.system.player;\n    let decrypt=p.roll(p.character.getdecryption());\n    if(decrypt==CRITICALMISS){\n      sound.play(sound.CRASH);\n      console.print('You destroy the file by accident!');\n      this.leave(this.node);\n      return false;\n    }\n    return this.hack(false,decrypt);\n  }\n  \n  download(){\n    let name='File '+this.getserial();\n    this.setname(name);\n    console.print('You start downloading '+name+\n      ' ('+this.size+' blocks)...');\n    this.downloading=0;\n    deck.storageused+=this.size;\n    this.ap=this.system.player.ap;\n  }\n  \n  click(){\n    if(this.downloading!=NOTDOWNLOADING){\n      console.print('You are already downloading this.');\n      return;\n    }\n    this.system.player.ap+=.5;\n    if(this.trap){\n      this.leave(this.node);\n      console.print('The file was a honeypot!');\n      this.system.raisealert(2);\n      return;\n    }\n    if(this.size>deck.getfreestorage()){\n      console.print(\"You need \"+this.size+\n        \" free storage blocks.\");\n      return;\n    }\n    this.system.player.ap+=.5;\n    if(this.decrypt()) this.download();\n  }\n  \n  act(){ //TODO deck download speed upgrade?\n    this.ap+=.5;\n    if(this.downloading==NOTDOWNLOADING) return;\n    this.downloading+=.5;\n    if(this.downloading<this.size){\n      let done=Math.round(100*this.downloading/this.size);\n      console.print('Downloading '+this.name+'... '+\n        done+'% done.');\n      return;\n    }\n    let value=offlinehero.sell(this.purchasedc);\n    let result='Downloaded '+this.name+'. ';\n    if(value==0){\n      result+='It was worthless and discarded.';\n      deck.storageused-=this.size;\n    }else{\n      result+='It is worth '+value+'¥!';\n    }\n    console.print(result);\n    this.leave(this.node);\n  }\n  \n  die(){\n    if(this.downloading!=NOTDOWNLOADING)\n      deck.storageused+=this.size;\n  }\n  \n  setname(name){\n    super.setname(name);\n    if(this.scanned)\n      this.tooltip+=' ('+this.size+' blocks)';\n  }\n}\n","import {Avatar} from './avatar';\nimport {Disconnect} from '../../../messages';\n\nexport class Gateway extends Avatar{\n  constructor(system){\n    super(system);\n    this.setname('Gateway');\n    this.setimage('nodes/gateway.png');\n    this.scanned=true;\n  }\n  \n  click(){\n    //TODO add free disconnect program, can cause alarm\n    if(window.confirm('Do you want to leave the system?'))\n      throw new Disconnect();\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Map extends Avatar{\n  scan(){\n    this.setimage('nodes/map.bmp');\n    this.setname('Map');\n  }\n  \n  click(){this.system.reveal();}\n}\n","import {Avatar} from './avatar';\nimport {console} from '../console';\nimport {hero as offline} from '../../character/character';\nimport {rpg,CRITICALHIT,CRITICALMISS} from '../../rpg';\nimport {sound} from '../../sound';\nimport {Disconnect} from '../../../messages';\n\nexport class Player extends Avatar{\n  constructor(system){\n    super(system);\n    this.setname(offline.name);\n    this.setimage('characters/'+offline.image+'.png');\n    this.scanned=true;\n    this.target=false; //current target (ICE)\n    this.credentials=10+this.character.getforgery();\n    system.player=this;\n  }\n  \n  create(characterclass,level){\n    this.character=offline.connect();\n  }\n  \n  roll(bonus,roll=false){\n    if(!roll) roll=rpg.r(1,20);\n    if(roll==1) return CRITICALMISS;\n    if(roll==20) return CRITICALMISS;\n    if(this.system.alert){\n      let concentration=rpg.r(1,20)+\n        this.character.getconcentration();\n      let penalty=2*this.system.alert-concentration/5;\n      bonus-=Math.max(0,Math.round(penalty));\n    }\n    //TODO light/heavy deck bonus\n    return roll+bonus;\n  }\n  \n  enter(node){\n    let first=!this.node;\n    if(first) console.print('You enter the system...');\n    if(!super.enter(node)) return false;\n    sound.play(first?sound.CONNECT:sound.MOVE);\n    node.visited=true;\n    this.node.scan(\n      this.roll(this.character.getperceive(),10));\n    return true;\n  }\n  \n  wait(){\n    sound.play(sound.SCAN);\n    console.print('You scan the node...');\n    this.ap+=.5;\n    this.node.scan(this.roll(this.character.getsearch()));\n  }\n  \n  click(){\n    //TODO maybe add % to deck and revert this to #wait()\n    let c=this.character;\n    let percent=Math.round(100*c.hp/c.maxhp);\n    let status='You currently have '+c.hp+\n      ' out of '+c.maxhp+' hit points '+\n      '('+percent+'%).';\n    console.print(status);\n  }\n  \n  act(){throw \"Players don't act programatically!\";}\n  \n  query(dc,source){ //ICE queries player\n    sound.play(sound.QUERY);\n    console.print(source.name+' queries you...');\n    if(this.credentials>=dc) return true;\n    let bluff=this.roll(this.character.getbluff());\n    if(bluff<dc) return false;\n    this.credentials=bluff;\n    return true;\n  }\n  \n  attack(bonus,target,damage,roll=false){\n    if(!roll){\n      roll=this.roll(bonus);\n      bonus=0;\n      if(roll==CRITICALMISS) roll=1;\n      else if(roll==CRITICALHIT) roll=20;\n    }\n    return super.attack(bonus,target,damage,roll);\n  }\n  \n  die(){\n    sound.play(sound.DISCONNECTED);\n    throw new Disconnect();\n  }\n  \n  hide(spotter){\n    return this.roll(this.character.getstealth())>=\n      10+spotter.character.getperceive();\n  }\n}\n","import {Avatar} from './avatar';\nimport {rpg} from '../../rpg';\nimport {console} from '../console';\nimport {sound} from '../../sound';\nimport {Disconnect} from '../../../messages';\n\nexport class Terminal extends Avatar{\n  create(characterclass,occupation,level){\n    super.create(characterclass,occupation,level+rpg.r(1,4));\n    let c=this.character;\n    c.defence+=this.character.level;\n    for(let s of ['bluff','perceive']) c.learnskill(s);\n  }\n  \n  scan(){\n    this.setimage('nodes/terminal.png');\n    this.setname('Terminal');\n  }\n  \n  click(){\n    if(this.hack(true)){\n      sound.play(sound.CRASH);\n      let d=new Disconnect(true);\n      d.message='You have crashed the mainframe!';\n      throw d;\n    }\n  }\n}\n","import {rpg} from '../../rpg';\nimport {Node} from './node';\nimport {Alarm} from '../avatar/alarm';\nimport {Entry} from '../avatar/entry';\nimport {Map} from '../avatar/map';\nimport {Terminal} from '../avatar/terminal';\n\nvar FUNCTIONS=4;\n\nexport class Cpu extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=2;\n  }\n  \n  setmain(){\n    this.enter(new Alarm(this.system));\n    this.enter(new Entry(this.system));\n    this.enter(new Map(this.system));\n    this.enter(new Terminal(this.system));\n  }\n  \n  generate(){\n    while(this.avatars.length==0){\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Alarm(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Entry(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Map(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Terminal(this.system));\n    }\n  }\n}\n","import {Node} from './node';\nimport {File} from '../avatar/file';\nimport {rpg} from '../../rpg';\n\nexport class Datastore extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=1;\n  }\n  \n  generate(){\n    let files=rpg.r(1,4);\n    for(let i=0;i<files;i++){\n      this.enter(new File(this.system));\n    }\n  }\n}\n","import {Node} from './node';\nimport {Backdoor} from '../avatar/backdoor';\nimport {Control} from '../avatar/control';\nimport {rpg} from '../../rpg';\n\nexport class Interface extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=1;\n  }\n  \n  generate(){\n    while(this.avatars.length==0){\n      if(rpg.chancein(4)) this.enter(new Control(this.system));\n      if(rpg.chancein(6)) this.enter(new Backdoor(this.system));\n    }\n  }\n}\n","import {rpg} from '../../rpg';\nimport environment from '../../../environment';\nimport {console} from '../console';\nimport {sound} from '../../sound';\nimport {Ice} from '../avatar/ice/ice';\n\nvar TILES=[];\n\nfor(let x=0;x<environment.nodesize;x++) \n  for(let y=0;y<environment.nodesize;y++)\n    TILES.push([x,y]);\n\nexport class Node{\n  constructor(x,y,system){\n    this.x=x;\n    this.y=y;\n    this.id=system.nodes.length;\n    this.priority=0;\n    this.system=system;\n    this.avatars=[];\n    this.visited=false;\n  }\n  \n  generate(){\n    // override\n  }\n  \n  getneighbors(){\n    let neighbors=[];\n    for(let xy of [[-1,0],[+1,0],[0,+1],[0,-1]]){\n      let n=this.system.getnode(this.x+xy[0],this.y+xy[1]);\n      if(n) neighbors.push(n);\n    }\n    return neighbors;\n  }\n  \n  getavatar(x,y){\n    for(let a of this.avatars) if(a.x==x&&a.y==y) return a;\n    return null;\n  }\n  \n  remove(avatar){//TODO should be called leave\n    if(avatar.node!=this)\n      throw 'Removing '+avatar.name+' from random node?';\n    let p=this.system.player;\n    if(avatar instanceof Ice&&this==p.node&&\n      avatar.character.hp>0){\n        sound.play(sound.ICELEAVE);\n        console.print(avatar.name+' leaves the node...');\n    }\n    avatar.node=false;\n    this.avatars.splice(this.avatars.indexOf(avatar),1);\n    if(p==avatar) p.target=false;\n    else if(p.target==avatar) p.target=false;\n  }\n  \n  /* return true if found free spot \n   * always prefer Avatar#enter(node) */\n  enter(avatar){\n    let source=avatar.node;\n    if(source==this) return false;\n    if(source&&source.getneighbors().indexOf(this)<0){\n      console.print(\"Can only move into adjacent nodes...\");\n      return false;\n    }\n    rpg.shuffle(TILES);\n    for(let xy of TILES) if(!this.getavatar(xy[0],xy[1])){\n      if(this.system.player&&this==this.system.player.node){\n        sound.play(sound.ICEENTER);\n        console.print(avatar.name+' enters the node.');\n      }\n      if(avatar.node) avatar.leave(avatar.node);\n      avatar.x=xy[0];\n      avatar.y=xy[1];\n      avatar.node=this;\n      avatar.ap+=avatar.character.move();\n      this.avatars.push(avatar);\n      return true;\n    }\n    return false;\n  }\n  \n  scan(roll){\n    for(let a of this.avatars.slice())\n      if(!a.scanned&&roll>=a.scandc){\n        a.scan();\n        a.scanned=true;\n      }\n  }\n}\n","import {Node} from './node';\nimport {Gateway} from '../avatar/gateway';\n\n/*TODO \n * - make it part of the normal generation to hop to other systems\n * - at first can even have it as \"stairs down\" */\nexport class Portal extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=2;\n  }\n  \n  generate(){\n    this.enter(new Gateway(this.system));\n  }\n}\n","import {Avatar} from '../avatar';\nimport {console} from '../../console';\nimport {rpg} from '../../../rpg';\nimport {sound} from '../../../sound';\nimport {refresh} from '../../../../cyberspace/infojack-cyberspace';\n\nexport class Ice extends Avatar{\n  constructor(image,system){\n    super(system);\n    this.revealed=image;\n    if(this.character.ranks>0||this.character.pointextra>0||\n      this.character.newfeats>0) \n        console.log('Unspent points for '+this.name);\n  }\n  \n  click(){\n    if(!this.scanned) return;\n    let p=this.system.player;\n    if(p.target==this){\n      p.target=false;\n      console.print('Target cleared...');\n    }else{\n      p.target=this;\n      console.print('Targeting '+this.name+'...');\n    }\n    refresh();\n  }\n  \n  scan(){\n    this.setname(this.constructor.name+' '+this.getserial());\n    this.setimage(this.revealed);\n  }\n  \n  act(){throw 'Unimplemented Ice#act() for '+this.name;}\n  \n  //returns true on attempt, hit or not\n  attack(bonus,target,damage,roll=false){\n    if(this.system.alert!=2||target.node!=this.node)\n      return false;\n    this.ap+=.5;\n    sound.play(sound.ICEATTACK);\n    console.print(this.name+' attacks!');\n    super.attack(bonus,target,damage)\n    return true;\n  }\n  \n  getdamage(){return rpg.r(1,this.getscale());}\n  \n  die(){\n    super.die();\n    this.system.reentry.push(this);\n  }\n}\n","import {Ice} from './ice';\nimport {rpg} from '../../../rpg';\nimport {console} from '../../console';\n\n//prevents 50% of turning back into a room, on worst-case\nvar PATHHISTORY=2;\n\nexport class Scout extends Ice{\n  constructor(system){\n    super('ice/scout.png',system);\n    this.path=[];\n  }\n  \n  create(characterclass,occupation,level){\n    super.create(characterclass,occupation,level);\n    let c=this.character;\n    c.learnability('wisdom');\n    for(let s of ['perceive','stealth']) c.learnskill(s);\n    c.learnfeat('improved initiative'); //TODO Alert-style feat would be better\n    c.speed+=this.character.level;\n  }\n  \n  enter(node){\n    if(!super.enter(node)) return false;\n    this.path.push(node);\n    if(this.path.length>PATHHISTORY) this.path.shift();\n    return true;\n  }\n  \n  query(){ //return false if failed query\n    if(this.system.alert==2) return true;\n    let p=this.system.player;\n    if(p.node!=this.node) return true;\n    let c=p.character;\n    if(p.hide(this)) return true;\n    this.ap+=.5;\n    let bluff=rpg.r(1,20)+this.character.getbluff();\n    if(p.query(bluff,this)) return true;\n    this.system.raisealert();\n    this.path=[];\n    return false;\n  }\n  \n  getdestination(){\n    let ns=this.node.getneighbors();\n    if(this.system.alert){\n      let p=this.system.player;\n      let spotdc=p.roll(p.character.getstealth(),10);\n      let spot=rpg.r(1,20)+this.character.getperceive();\n      if(spot>=spotdc) for(let n of ns) if(n==p.node){\n        this.path=[];\n        return n;\n      }\n    }\n    ns=rpg.shuffle(ns);\n    for(let n of ns) if(this.path.indexOf(n)<0) return n;\n    return ns[0];\n  }\n  \n  move(){\n    if(this.system.alert>0&&\n      this.system.player.node==this.node) return false;\n    this.enter(this.getdestination());\n    this.query();\n    return true;\n  }\n  \n  act(){\n    let ranged=this.character.getranged();\n    let damage=this.getdamage();\n    if(this.attack(ranged,this.system.player,damage))   \n      return;\n    if(!this.query()) return;\n    this.move();\n  }\n}\n"],"sourceRoot":".."}