{"version":3,"sources":["app.js","empty.js","environment.js","infojack-cyberspace.js","infojack-mainmenu.js","infojack-radio.js","infojack-topmenu.js","main.js","messages.js","character/character-abilities.js","character/character-details.js","character/character-feats.js","character/character-screen.js","character/character-skills.js","modules/characters.js","modules/classes.js","modules/feats.js","modules/occupations.js","modules/rpg.js","modules/save.js","modules/skills.js","modules/sound.js","resources/index.js","modules/cyberspace/system.js","modules/cyberspace/avatar/alarm.js","modules/cyberspace/avatar/avatar.js","modules/cyberspace/avatar/backdoor.js","modules/cyberspace/avatar/control.js","modules/cyberspace/avatar/entry.js","modules/cyberspace/avatar/file.js","modules/cyberspace/avatar/gateway.js","modules/cyberspace/avatar/map.js","modules/cyberspace/avatar/player.js","modules/cyberspace/avatar/terminal.js","modules/cyberspace/node/cpu.js","modules/cyberspace/node/datastore.js","modules/cyberspace/node/interface.js","modules/cyberspace/node/node.js","modules/cyberspace/node/portal.js"],"names":["App","Example","debug","testing","TILESIZE","SPACING","FADETIME","Cyberspace","sound","messaging","me","subscribe","show","view","init","map","document","querySelector","innerHTML","system","player","tiles","drawn","draw","clicktile","tile","tagName","parentNode","node","nodes","nodeid","avatar","getavatar","nodex","nodey","click","enter","placenode","refresh","placetile","x","y","createElement","push","classList","add","id","onclick","style","width","height","left","size","top","placespacer","farx","fary","t","bounds","getBoundingClientRect","right","bottom","spacer","body","scrollTop","scrollLeft","appendChild","expand","indexOf","getneighbors","n","entrance","scrollIntoView","addimage","scanned","image","src","title","tooltip","removeimage","opacity","fade","setTimeout","removeChild","revealed","visited","border","DEBUGVIEW","MainMenu","save","hassave","checkload","close","showpending","play","ERROR","alert","startgame","prompt","confirm","clear","loadgame","load","open","publish","openrepository","window","Radio","active","audio","pause","TopMenu","hideradio","configure","Promise","config","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","then","setRoot","ShowView","CharacterAbilities","hero","costs","strength","attached","dexterity","constitution","intelligence","wisdom","charisma","pointbuy","pointextra","detached","clone","Object","assign","upgrade","ability","current","buy","ranks","level","next","cost","CharacterDetails","CharacterFeats","Save","feats","BindingSignaler","signals","feat","newfeats","addfeat","signal","validate","STARTINGSCREEN","CharacterScreen","showabilities","showskills","showfeats","showdetails","select","e","target","charactermenu","childNodes","button","classes","replace","remove","CharacterSkills","skills","values","s","name","getskill","iscrossclass","skill","classskills","includes","canupgrade","setskill","value","Character","wealth","bab","edgedice","edge","fort","ref","will","defence","talent","contacts","toLowerCase","data","key","setoccupation","occupation","addclassskill","connect","enhancecrawler","Math","max","getmodifier","hasfeat","f","rollskill","bonus","r","rollbluff","bluff","rolldecryption","decryption","rolleletronics","eletronics","rollforgery","forgery","rollinformation","information","rollhacking","hacking","rollperceive","perceive","rollmedicine","medicine","rollstealth","stealth","rollprofession","profession","fase","rollresearch","research","rollsearch","search","rolltechnology","technology","adventurer","advance","Class","character","levelup","c","classlevel","upgradestat","upgradeedgedice","upgradereputation","hp","hd","addskills","d","stat","last","split","parseInt","reputation","Webcrawler","webcrawler","Map","Feat","description","apply","Educated","Meticulous","Stealthy","Studious","Trustworthy","set","Occupation","skillsp","occupations","Rpg","min","floor","random","dice","sides","sum","i","choose","list","length","chancein","shuffle","array","j","swap","randomize","amount","rpg","dodebug","localStorage","getItem","JSON","parse","populate","initialize","setItem","stringify","checkskills","Skill","ss","get","Sound","PREFIX","file","Audio","REVEAL","SCAN","System","ice","generatemap","definenodes","generate","reveal","avatars","a","scan","getnode","leastx","leasty","replacenode","original","findentrance","neighbors","portals","filter","generatenode","setmain","entrancei","corridor","Alarm","setimage","Avatar","constructor","scandc","Backdoor","Control","Entry","File","worthless","trap","protected","Gateway","Player","Terminal","FUNCTIONS","Cpu","priority","Datastore","files","Interface","SIZE","TILES","Node","xy","splice","slice","Portal"],"mappings":"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","file":"app-bundle.js","sourcesContent":["export class App {\n  constructor() {\n  }\n}\n","export class Example {\n    constructor() {\n    }\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","import {System} from './modules/cyberspace/system';\nimport {Player} from './modules/cyberspace/avatar/player';\nimport {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {Sound} from './modules/sound';\nimport {ShowView} from './messages';\n\nvar TILESIZE=2.5;\nvar SPACING=1.1;\nvar FADETIME=2000;\n\n@inject(Sound,EventAggregator)\nexport class Cyberspace{\n  constructor(sound,messaging){\n    let me=this;\n    messaging.subscribe(ShowView,function(show){\n        if(show.view=='Cyberspace') me.init();\n    });\n  }\n  \n  init(){\n    //TODO clean previous run\n    this.map=document.querySelector('#cyberspace');\n    this.map.innerHTML='';\n    this.system=new System(20);\n    this.player=\n      new Player('characters/tile000.png',this.system);\n    this.tiles=[];\n    this.drawn=[];\n    this.draw();\n  }\n\n  clicktile(tile){\n    if(tile.tagName=='IMG') tile=tile.parentNode;\n    let node=this.system.nodes[tile.nodeid];\n    let avatar=node==this.player.node&&\n      node.getavatar(tile.nodex,tile.nodey);\n    if(avatar){\n      avatar.click();\n    }else{\n      this.player.enter(node);\n      this.placenode(node,true);\n    }\n    this.refresh();\n  }\n\n  placetile(x,y,node){\n    let tile=document.createElement('div');\n    this.tiles.push(tile);\n    tile.classList.add('tile');\n    tile.nodeid=node.id;\n    tile.nodex=x;\n    tile.nodey=y;\n    let me=this;\n    tile.onclick=function(){me.clicktile(this);};\n    let style=tile.style;\n    style.width=TILESIZE+'em';\n    style.height=TILESIZE+'em';\n    style.left=(((node.x*SPACING)*node.size+x)*TILESIZE)+'em';\n    style.top=(((node.y*SPACING)*node.size+y)*TILESIZE)+'em';\n    return tile;\n  }\n\n  placespacer(){\n    let farx=0;\n    let fary=0;\n    for(let t of this.tiles){\n      let bounds=t.getBoundingClientRect();\n      if(bounds.right>farx) farx=bounds.right;\n      if(bounds.bottom>fary) fary=bounds.bottom;\n    }\n    let spacer=document.createElement('div');\n    spacer.classList.add('spacer');\n    spacer.style.top=(document.body.scrollTop+fary)+'px';\n    spacer.style.left=(document.body.scrollLeft+farx)+'px';\n    this.map.appendChild(spacer);\n  }\n\n  placenode(node,expand){\n    if(this.drawn.indexOf(node)<0){\n      this.drawn.push(node);\n      for(let x=0;x<node.size;x++)\n        for(let y=0;y<node.size;y++)\n          this.map.appendChild(this.placetile(x,y,node));\n    }\n    if(expand) for(let n of node.getneighbors())\n      this.placenode(n,false);\n    this.placespacer();\n  }\n\n  draw(){\n    this.placenode(this.system.entrance,true);\n    this.player.enter(this.system.entrance);\n    this.refresh();\n    for(let t of this.tiles){\n      if(t.nodeid==this.player.node.id&&\n        t.nodex==this.player.x&&t.nodey==this.player.y){\n        t.scrollIntoView();\n        break;\n      }\n    }\n  }\n\n  addimage(tile,avatar){\n    tile.avatar=avatar;\n    tile.scanned=avatar.scanned;\n    let image=document.createElement('img');\n    image.src=avatar.image;\n    image.title=avatar.tooltip;\n    tile.appendChild(image);\n    tile.image=image;\n  }\n\n  removeimage(tile){\n    tile.avatar=null;\n    tile.image.style.opacity=0;\n    let fade=tile.image;\n    tile.image=null;\n    setTimeout(function(){tile.removeChild(fade);},FADETIME);\n  }\n\n  refresh(){\n    if(this.system.revealed) for(let n of this.system.nodes) \n      this.placenode(n,false);\n    for(let t of this.tiles){\n      let node=this.system.nodes[t.nodeid];\n      if(t.style.opacity==0) setTimeout(function(){\n        t.classList.add('discovered');\n      },1);\n      if(!node.visited) continue;\n      if(!t.style.border) t.classList.add('visited');\n      let avatar=node.getavatar(t.nodex,t.nodey);\n      if(t.image&&(!avatar||\n        avatar!=t.avatar||t.scanned!=avatar.scanned)) \n          this.removeimage(t);\n      if(avatar&&avatar!=t.avatar) this.addimage(t,avatar);\n    }\n  }\n}\n","import {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {Sound} from './modules/sound';\nimport {Save} from './modules/save';\nimport {ShowView} from './messages';\n\nvar DEBUGVIEW='Cyberspace';\n\n@inject(Sound,Save,EventAggregator)\nexport class MainMenu {\n    constructor(sound,save,messaging) {\n        this.sound=sound;\n        this.save=save;\n        this.show=true;\n        this.messaging=messaging;\n        this.hassave=save.checkload()!=false;\n        if(DEBUGVIEW){\n          let me=this;\n          setTimeout(function(){me.close(DEBUGVIEW);},1);\n        }\n    }\n  \n    showpending(){\n        this.sound.play(this.sound.ERROR);\n        setTimeout(function(){\n            alert('Operation pending!');\n        },100);\n    }\n    \n    startgame(){\n        let prompt='Are you sure you want to start a new game? Any previous progress will be lost!';\n        if(this.hassave&&!confirm(prompt)){\n            return;\n        }\n        this.save.clear();\n        this.close('CharacterScreen');\n    }\n    \n    loadgame(){\n        if(!this.hassave){\n            this.sound.play(this.sound.ERROR);\n        }\n        this.save.load();\n        this.close('CharacterScreen');//TODO open map\n    }\n    \n    close(open){\n        this.show=false;\n        open='Cyberspace';\n        alert(open);\n        this.messaging.publish(new ShowView(open));\n    }\n      \n    openrepository(){\n      window.open('https://github.com/tukkek/infojack');\n    }\n}\n","export class Radio {\n    constructor() {\n        this.active=false;\n    }\n  \n    play(){\n        this.audio.play();\n        if(!this.active){\n            this.audio.play();\n        } else {\n            this.audio.pause();\n        }\n        return true;\n    }\n}\n","export class TopMenu{\n    constructor(){\n        this.hideradio=true;\n    }\n    \n    open(){\n        this.hideradio=!this.hideradio;\n    }\n}\n","import environment from './environment';\n\n//Configure Bluebird Promises.\nPromise.config({\n  warnings: {\n    wForgottenReturn: false\n  }\n});\n\nexport function configure(aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","export class ShowView{\n    constructor(view){\n        this.view=view;//CharacterScreen\n    }\n}\n","//TODO needs to boost Character#ranks with int\n\nimport {hero,costs} from '../modules/characters';\nimport {Save} from '../modules/save';\nimport {inject} from 'aurelia-framework';\n\n/* TODO add difficulty modes */\n@inject(hero,costs,Save)\nexport class CharacterAbilities {\n    constructor(hero,costs,save) {\n        this.hero=hero;\n        this.costs=costs;\n        this.save=save;\n        this.strength=-1;\n    }\n    \n    attached(){\n        this.strength=this.hero.strength;\n        this.dexterity=this.hero.dexterity;\n        this.constitution=this.hero.constitution;\n        this.intelligence=this.hero.intelligence;\n        this.wisdom=this.hero.wisdom;\n        this.charisma=this.hero.charisma;\n        this.pointbuy=this.hero.pointbuy;\n        this.pointextra=this.hero.pointextra;\n    }\n    \n    detached(){\n        let clone={};\n        Object.assign(clone,this);\n        delete clone.costs;\n        delete clone.hero;\n        delete clone.save;\n        this.hero.assign(clone);\n        this.save.save();\n    }\n\n    upgrade(ability){\n        let current=this[ability];\n        if(current==18){\n            return;\n        }\n        if(this.pointextra>0){\n            this.pointextra-=1;\n            this[ability]+=1;        \n        }else if(this.buy(current)){\n            this[ability]+=1;        \n        }else return;\n        if(ability=='intelligence'){\n            this.hero.ranks+=this.hero.level==1?4:1;\n        }\n    }\n    \n    buy(current){\n        let next=current+1;\n        let cost=this.costs[next]-this.costs[current];\n        if(this.pointbuy>=cost){\n            this.pointbuy-=cost;\n            return true;\n        }\n        return false;\n    }\n}\n","export class CharacterDetails {\n    constructor() {\n    }\n}\n","import {feats} from '../modules/feats';\nimport {hero} from '../modules/characters';\nimport {Save} from '../modules/save';\nimport {inject} from 'aurelia-framework';\nimport {BindingSignaler} from 'aurelia-templating-resources';\n\n@inject(Save,feats,hero,BindingSignaler)\nexport class CharacterFeats {\n    constructor(Save,feats,hero,BindingSignaler) {\n        this.save=Save;\n        this.feats=feats;\n        this.hero=hero;\n        this.signals=BindingSignaler;\n    }\n    \n    add(feat){\n        if(hero.newfeats==0) return;\n        hero.newfeats-=1;\n        this.hero.addfeat(feat);\n        this.save.save();\n        this.signals.signal('update');\n    }\n    \n    validate(feat){\n        return hero.newfeats>0&&feat.validate(hero);\n    }\n}\n","//TODO add talents\n\nimport {inject} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {ShowView} from '../messages';\n\nvar STARTINGSCREEN='CharacterScreen';\n\n@inject(EventAggregator)\nexport class CharacterScreen {\n    constructor(messaging) {\n        this.show=false;\n        this.showabilities=true;\n        this.showskills=false;\n        this.showfeats=false;\n        this.showdetails=false;\n        \n        let me=this;\n        messaging.subscribe(ShowView,function(show){\n            if(show.view==STARTINGSCREEN){\n                me.show=true;\n            }\n        });\n    }\n    \n    select(e){\n        let id=e.target.id;\n        for(let button of this.charactermenu.childNodes){\n            let classes=button.classList;\n            if(!classes){\n                continue;\n            }\n            var show=button.id==id;\n            this['show'+button.id.replace('character-','')]=show;\n            if(show){\n                classes.add('highlightbg');\n            } else {\n                classes.remove('highlightbg');\n            }\n        }\n    }\n    \n    close(){\n        this.show=false;\n    }\n}\n\n","import {skills} from '../modules/skills';\nimport {hero} from '../modules/characters';\nimport {Save} from '../modules/save';\nimport {inject} from 'aurelia-framework';\n\n@inject(Save,skills,hero)\nexport class CharacterSkills {\n    constructor(Save,skills,hero) {\n        this.save=Save;\n        this.skills=skills;\n        this.values={};\n        this.hero=hero;\n        for(let s of skills.values()) this.values[s.name]=hero.getskill(s.name);\n    }\n    \n    iscrossclass(skill){\n        return !hero.classskills.includes(skill);\n    }\n    \n    buy(skill){\n        return this.iscrossclass(skill)?2:1;\n    }\n    \n    upgrade(skill){\n        if(!this.canupgrade(this.values[skill],skill)) return;\n        let cost=this.buy(skill);\n        hero.ranks-=cost;\n        this.values[skill]+=1;\n        hero.setskill(skill,this.values[skill]);\n        this.save.save();\n    }\n    \n    canupgrade(value,skill){\n        let cost=this.buy(skill);\n        return hero.ranks>=cost && value<3+hero.level;\n    }\n}\n","//TODO convert primary BAB elsewhere\n\nimport {occupations} from './occupations';\nimport {webcrawler} from './classes';\nimport {skills} from './skills';\nimport {rpg} from './rpg';\n\nexport class Character{\n    constructor(){\n        this.strength=7;\n        this.dexterity=7;\n        this.constitution=7;\n        this.intelligence=7;\n        this.wisdom=7;\n        this.charisma=7;\n        this.pointbuy=15+4*6;\n        this.pointextra=0;\n        this.wealth=0;\n        this.classskills=[];\n        this.classes={};//holds levels\n        this.level=0;\n        this.ranks=0;\n        this.bab=0;//hold only primary BAB\n        this.edgedice=[0,0];//0d1\n        this.edge=0;//current edge\n        this.fort=0;\n        this.ref=0;\n        this.will=0;\n        this.defence=0;\n        this.talent=0;\n        this.contacts=0;//TODO\n        this.feats=[];\n        this.newfeats=2;\n        for(let s of skills.values()){\n            this[s.name.replace(' ','').toLowerCase()]=0;\n        }\n    }\n\n    //makes sure not to write new data\n    assign(data){\n        for(let key in data){\n            if(key in this){\n                this[key]=data[key];\n            }\n        }\n    }\n    \n    setoccupation(occupation){\n        this.wealth+=occupation.wealth;\n        for(let s of occupation.skills){\n            this.addclassskill(s);\n        }\n    }\n    \n    addclassskill(s){\n        if(this.classskills.indexOf(s)<0){\n            this.classskills.push(s);\n        }\n    }\n    \n    //TODO use\n    connect(){\n        let avatar={};\n        Object.assign(avatar,this);\n        if('Webcrawler' in this.classes){\n            this.enhancecrawler(avatar);\n        }\n        return avatar;\n    }\n    \n    enhancecrawler(avatar){\n        avatar.strength=Math.max(\n            avatar.strength,avatar.intelligence);\n        avatar.dexterity=Math.max(\n            avatar.dexterity,avatar.wisdom);\n        avatar.constitution=Math.max(\n            avatar.constitution,avatar.charisma);\n        let level=this.classes['Webcrawler'];\n        avatar.bab-=[0,1,1,2,2,3,3,4,4,5][level-1];\n        avatar.bab+=level;\n    }\n    \n    getmodifier(ability){\n        if(ability%2==1){\n            ability-=1;\n        }\n        return (ability-10)/2;\n    }\n    \n    getskill(name){\n        return this[name.replace(' ','').toLowerCase()];\n    }\n    \n    setskill(name,value){\n        this[name.replace(' ','').toLowerCase()]=value;\n    }\n    \n    hasfeat(f){\n        f=f.name||f;\n        for(let feat of this.feats) if(feat.name==f) return feat;\n        return false;\n    }\n    \n    addfeat(f){\n        this.feats.push(f);\n    }\n    \n    rollskill(ranks,feat,bonus){\n        if(feat&&hasfeat(feat)) ranks+=bonus;\n        return rpg.r(1,20)+ranks;\n    }\n    \n    rollbluff(){\n        return rollskill(this.bluff,false,0);\n    }\n    \n    rolldecryption(){\n        return rollskill(this.decryption,'studious',2);\n    }\n    \n    rolleletronics(){\n        return rollskill(this.eletronics,false,0);\n    }\n    \n    rollforgery(){\n        return rollskill(this.forgery,'meticulous',2);\n    }\n    \n    rollinformation(){\n        return rollskill(this.information,'trustworthy',3);\n    }\n    \n    rollhacking(){\n        return rollskill(this.hacking,false,0);\n    }\n    \n    rollperceive(){\n        return rollskill(this.perceive,false,0);\n    }\n    \n    rollmedicine(){\n        return rollskill(this.medicine,false,0);\n    }\n    \n    rollstealth(){\n        return rollskill(this.stealth,'stealthy',3);\n    }\n    \n    rollprofession(){\n        return rollskill(this.profession,fase,0);\n    }\n    \n    rollresearch(){\n        return rollskill(this.research,'studious',2);\n    }\n    \n    rollsearch(){\n        return rollskill(this.search,'meticulous',2);\n    }\n    \n    rolltechnology(){\n        return rollskill(this.technology,'educated',3);\n    }\n}\n\nexport var hero=new Character();\nhero.setoccupation(occupations.adventurer);\nwebcrawler.advance(hero); //becomes level 1\n\nexport var costs={\n    7:-4,\n    8:-2,\n    9:-1,\n    10:0,\n    11:1,\n    12:2,\n    13:3,\n    14:5,\n    15:7,\n    16:10,\n    17:13,\n    18:17,\n}\n","/*TODO \n * for advanced classes, have edge dice as part of levelup\n */\n\nimport {checkskills} from './skills';\nimport {rpg} from './rpg';\n\nclass Class{\n    constructor(){\n        //default\n    }\n    \n    advance(character){\n        let level=0;\n        if(this.name in character.classes){\n            level=character.classes[this.name];\n        }\n        level+=1;\n        if(level>10) {\n            throw 'Cannot advance past level 10!';\n        }\n        this.levelup(character,level);\n        character.classes[this.name]=level;\n    }\n    \n    levelup(c,classlevel){\n        c.level+=1;\n        this.upgradestat(classlevel,'bab',c);\n        this.upgradestat(classlevel,'fort',c);\n        this.upgradestat(classlevel,'ref',c);\n        this.upgradestat(classlevel,'will',c);\n        this.upgradestat(classlevel,'defence',c);\n        this.upgradeedgedice(classlevel,c);\n        this.upgradereputation(classlevel);\n        c.ranks+=Math.max(1,this.ranks+c.getmodifier(c.intelligence));\n        if(c.level==1){\n            c.hp=this.hd;\n            c.edge+=c.edgedice[0];\n            c.ranks=c.ranks*4;\n            this.addskills(c);\n        }else{\n            c.hp+=rpg.d(1,this.hd);\n        }\n    }\n    \n    addskills(c){\n        for(let s of this.skills){\n            c.addclassskill(s);\n        }\n    }\n    \n    upgradestat(level,stat,c){\n        let last=0;\n        if(level>1){\n            last=this[stat][level-2];\n        }\n        let current=this[stat][level-1];\n        c[stat]+=current-last;\n    }\n    \n    upgradeedgedice(level,c){\n        let target=\n            this.edgedice[level-1].split('d');\n        target=[parseInt(target[0]),\n            parseInt(target[1])];\n        if(target[0]>c.edgedice[0]||\n            (target[0]==c.edgedice[0]&&\n                target[1]>=c.edgedice[1])){\n            c.edgedice[0]=target[0];\n            c.edgedice[1]=target[1];\n        }\n    }\n    \n    upgradereputation(level){\n        if(level==1){\n            if(this.reputation[0]>0){\n                //TODO boost\n            }\n        }else if(this.reputation[level-1]>\n                this.reputation[level-2]){\n            //TODO boost\n        }\n    }\n}\n\nclass Webcrawler extends Class{\n    constructor(){\n        super();\n        this.name='Webcrawler';\n        this.skills=checkskills(['Hacking', 'Electronics', 'Decryption', /*'Disable device',*/ 'Forgery', 'Technology', 'Profession', 'Research', 'Technology', 'Search']);\n        this.hd=4;\n        this.ranks=7;\n        this.bab=[0,1,1,2,2,3,3,4,4,5];\n        this.fort=[0,0,1,1,1,2,2,2,3,3];\n        this.ref=[1,2,2,2,3,3,4,4,4,5];\n        this.will=[1,2,2,2,3,3,4,4,4,5];\n        this.defence=[1,1,2,2,2,3,3,3,4,4];\n        this.reputation=[0,1,1,2,2,3,3,4,4,5];\n        this.edgedice=['1d4','1d4','2d4','2d6','2d6','3d6','3d8','3d8','4d8','4d10'];\n    }\n    \n    levelup(character,classlevel){\n        super.levelup(character,classlevel);\n        let level=character.level;\n        if(level==1||level==3||level==6||level==9){\n            character.talent+=1;\n        }else if(level==4||level==7){\n            character.ranks+=1;\n        }else if(level==5||level==8){\n            character.contacts+=1;\n        }else if(level==10){\n            character.wealth+=5;\n            //TODO +5 reputation to law and hackers\n        }\n    }\n}\n\nexport var webcrawler=new Webcrawler();\n","export var feats=new Map();\n\nclass Feat{\n    constructor(name,description){\n        this.name=name;\n        this.description=description;\n    }\n    \n    validate(character){\n        return !character.hasfeat(this);\n    }\n    \n    apply(character){\n        character.addfeat(this);\n    }\n}\n\nclass Educated extends Feat{\n    constructor(){\n        super('Educated','+3 to Techonology rolls');\n    }\n}\n\nclass Meticulous extends Feat{\n    constructor(){\n        super('Meticulous','+2 to Forgery and Search rolls');\n    }\n}\n\nclass Stealthy extends Feat{\n    constructor(){\n        super('Stealthy','+3 to Stealth rolls');\n    }\n}\n\nclass Studious extends Feat{\n    constructor(){\n        super('Studious','+2 to Decrypt and Research rolls');\n    }\n}\n\nclass Trustworthy extends Feat{\n    constructor(){\n        super('Trustworthy','+3 to Information rolls');\n    }\n}\n\nfor(let feat of [\n    new Educated(),\n    new Meticulous(),\n    new Stealthy(),\n    new Stealthy(),\n    new Studious(),\n    new Trustworthy(),\n]) feats.set(feat.name.toLowerCase(),feat);\n","import {skills,checkskills} from './skills';\n\n//TODO feats\nclass Occupation{\n    constructor(wealth,skillsp){\n        this.wealth=wealth;\n        this.skills=skillsp;\n        checkskills(skillsp);\n    }\n}\n\nexport var occupations={};\n\noccupations.adventurer=new Occupation(+1,['Bluff','Technology','Stealth','Perceive','Medicine']);\n","class Rpg{\n    constructor(){}\n    \n    r(min,max){\n      return Math.floor((Math.random()*max)+min);\n    }\n    \n    d(dice,sides){\n        let sum=0;\n        for(let i=0;i<dice;i++){\n            sum+=this.r(1,sides);\n        }\n        return sum;\n    }\n    \n    choose(list){\n      return list[this.r(0,list.length-1)];\n    }\n    \n    chancein(n){\n      n=Math.floor(n);\n      return n>=1&&this.r(1,n)==1;\n    }\n    \n    shuffle(array){\n      for (let i=array.length-1;i>0;i--) {\n        let j=this.r(0,i+1);\n        let swap=array[i];\n        array[i]=array[j];\n        array[j]=swap;\n      }\n      return array;\n    }\n    \n    randomize(amount){\n      return this.r(1,amount)-this.r(1,amount);\n    }\n}\n\nexport var rpg=new Rpg();\n","import {hero} from './characters';\n\nexport class Save{\n    constructor(){\n        this.dodebug=false;\n    }\n    \n    checkload(){\n        return localStorage.getItem('infojack-save');\n    }\n    \n    load(){\n        let data=this.checkload();\n        if(!data){\n            return false;\n        }\n        data=JSON.parse(data);\n        this.populate(data);\n        this.initialize();\n        return true;\n    }\n\n    populate(data){\n        Object.assign(hero,data.hero);\n        this.debug();\n    }\n\n    initialize(){\n    }\n\n    //TODO use on game lost\n    //TODO use on game won\n    clear(){\n        localStorage.setItem('infojack-save','');\n    }\n\n    save(){\n        let data={};\n        data.hero=hero;\n        localStorage.setItem('infojack-save',JSON.stringify(data));\n        this.debug();\n    } \n    \n    debug(){\n        if(!this.dodebug)return;\n        let data=this.checkload();\n        if(data){\n            alert(data);\n        }\n    }\n}\n","class Skill{\n    constructor(name,description){\n        this.name=name;\n        this.description=description;\n    }\n}\n\nexport var skills=new Map();\n\nfor (let skill of [\n    new Skill('Bluff',\n        \"Convince ICE you're not an intruder.\"),\n    new Skill('Decryption',\n        \"Break into protected data.\"),\n    new Skill('Electronics',\n        \"Build and install hardware.\"),\n    new Skill('Forgery',\n        \"Forge authentication credentials.\"),\n    new Skill('Information',\n        \"Find more shopping items and missions.\"),\n    new Skill('Hacking',\n        \"Act on the Web.\"),\n    new Skill('Perceive',\n        \"Detect ICE and files on the Web.\"),\n    new Skill('Medicine',\n        \"Treat your injuries.\"),\n    new Skill('Stealth',\n        \"Avoid being detected on the Web.\"),\n    new Skill('Profession',\n        \"Earn more money.\"),\n    new Skill('Research',\n        \"Do perimeter checks on Frames.\"),\n    new Skill('Search',\n        \"Locate files in datastores.\"),\n    new Skill('Technology',\n        \"Create your own programs.\"),\n]){\n    skills.set(skill.name,skill);\n}\n\nexport function checkskills(ss){\n    for(let s of ss) if(!skills.get(s)) alert('Unknown skill: '+s);\n    return ss;\n}\n","export class Sound{\n    constructor(){\n        this.PREFIX='./sounds/';\n        this.ERROR='Computer Error Alert-SoundBible.com-783113881.mp3';\n    }\n     \n    play(file){\n        new Audio(this.PREFIX+file).play();\n    }\n}\n","export function configure(config) {\n  //config.globalResources([]);\n}\n","import {rpg} from '../rpg';\nimport {Node} from './node/node';\nimport {Datastore} from './node/datastore';\nimport {Cpu} from './node/cpu';\nimport {Portal} from './node/portal';\nimport {Interface} from './node/interface';\n\nvar REVEAL=true;\nvar SCAN=false;\n\nexport class System{\n  constructor(level){\n    this.revealed=false; //reveal all map\n    this.level=level;\n    if(this.level<1) this.level=1;\n    else if(this.level>20) this.level=20;\n    this.nodes=[];\n    this.ice=[];\n    this.entrance=null;\n    this.generatemap();\n    this.definenodes();\n    for(let n of this.nodes) n.generate();\n    this.debug();\n  }\n  \n  debug(){\n    if(REVEAL) this.reveal();\n    if(SCAN) for(let n of this.nodes) for(let a of n.avatars){\n      a.scan();\n      a.scanned=true;\n    }\n  }\n  \n  getnode(x,y){\n    for(let n of this.nodes) if(x==n.x&&y==n.y) return n;\n    return null;\n  }\n  \n  generatemap(){\n    this.nodes.push(new Cpu(0,0,this));\n    let size=rpg.r(3,7)+this.level;\n    let leastx=0;\n    let leasty=0;\n    while(this.nodes.length<size){\n      let n=rpg.choose(this.nodes);\n      let x=n.x;\n      let y=n.y;\n      if(rpg.chancein(2)) x+=rpg.chancein(2)?+1:-1;\n      else y+=rpg.chancein(2)?+1:-1;\n      if(this.getnode(x,y)) continue;\n      this.nodes.push(new Node(x,y,this));\n      if(x<leastx) leastx=x;\n      if(y<leasty) leasty=y;\n    }\n    for(let n of this.nodes){ //ensure node.x>=0 node.y>=0\n      n.x-=leastx;\n      n.y-=leasty;\n    }\n  }\n  \n  replacenode(target,i){\n    let original=this.nodes[i];\n    target.id=original.id;\n    target.x=original.x;\n    target.y=original.y;\n    this.nodes[i]=target;\n  }\n  \n  findentrance(neighbors){\n    let portals=this.nodes.filter(\n      n=>n.id!=0&&n.getneighbors().length==neighbors); \n    if(portals.length==0) return -1;\n    return this.nodes.indexOf(rpg.choose(portals));\n  }\n  \n  generatenode(){\n    if(rpg.chancein(10)) return new Cpu(-1,-1,this);\n    if(rpg.chancein(4)) return new Interface(-1,-1,this);\n    return new Datastore(-1,-1,this);\n  }\n  \n  definenodes(){\n    this.nodes[0].setmain();\n    let entrancei=-1;\n    for(let neighbors=1;entrancei==-1;neighbors++){\n      entrancei=this.findentrance(neighbors);\n    }\n    this.entrance=new Portal(-1,-1,this);\n    this.replacenode(this.entrance,entrancei);\n    for(let i=1;i<this.nodes.length;i++){\n      if(i==entrancei) continue;\n      let neighbors=this.nodes[i].getneighbors().length;\n      let corridor=neighbors>1&&rpg.chancein(6-neighbors);\n      if(corridor) continue;\n      this.replacenode(this.generatenode(),i);\n    }\n  }\n  \n  reveal(){\n    this.revealed=true;\n    for(let n of this.nodes) n.visited=true;\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Alarm extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/alarm.bmp');\n    this.tooltip='Alarm';\n  }\n  \n  click(){\n    super.click();\n  }\n}\n","import {System} from '../system';\nimport {rpg} from '../../rpg';\n\nexport class Avatar{\n  constructor(image,system){\n    this.setimage(image);\n    if(!(system instanceof System))\n      throw 'system type: '+system.constructor.name;\n    this.system=system;\n    this.node=null;\n    this.x=-1;\n    this.y=-1;\n    this.tooltip=this.constructor.name;\n    this.scanned=false;\n    this.scandc=this.system+rpg.randomize(10);\n    if(this.scandc<1) this.scandc=1;\n  }\n  \n  setimage(image){\n    this.image='./images/'+image;\n  }\n  \n  enter(node){\n    return node.enter(this);\n  }\n  \n  click(){\n    alert('clicky!');\n  }\n  \n  scan(){\n    return true;\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Backdoor extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/backdoor.bmp');\n    this.tooltip='Backdoor';\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Control extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/control.png');\n    this.tooltip='Control';\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Entry extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/entry.png');\n    this.tooltip='ICE entry';\n  }\n  \n  click(){\n    super.click();\n  }\n}\n","import {Avatar} from './avatar';\nimport {rpg} from '../../rpg';\n\nexport class File extends Avatar{\n  constructor(system){\n    super('nodes/fileunscanned.png',system);\n    this.tooltip='Data';\n    this.level=system.level+rpg.randomize(4);\n    this.worthless=this.level<1||rpg.chancein(system.level+1);\n    this.trap=!this.worthless&&\n      rpg.chancein(60/system.level);\n    this.protected=!this.worthless&&!this.trap&&\n      rpg.chancein(21/system.level);\n    if(this.worthless) this.level=0;\n    else if(this.protected&&this.level<system.level) \n      this.level=system.level;\n  }\n  \n  click(){\n    super.click();\n  }\n  \n  scan(){\n    if(this.worthless){\n      this.node.remove(this);\n    }else if(this.protected){\n      this.setimage('nodes/fileprotected.png');\n      this.tooltip='Protected data';\n    }else if(this.trap){\n      this.setimage('nodes/filetrap.png');\n      this.tooltip='Trap data';\n    }else{\n      this.setimage('nodes/file.png');\n    }\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Gateway extends Avatar{\n  constructor(system){\n    super('nodes/gateway.png',system);\n    this.scanned=true;\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Map extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/map.bmp');\n    this.tooltip='Map';\n  }\n  \n  click(){\n    this.system.reveal();\n    this.node.remove(this);\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Player extends Avatar{\n  constructor(image,system){\n    super(image,system);\n    this.scanned=true;\n  }\n  \n  enter(node){\n    if(!super.enter(node)) return false;\n    node.visited=true;\n    node.scan(); //TODO passive scan, roll-4\n    return true;\n  }\n}\n","import {Avatar} from './avatar';\n\nexport class Terminal extends Avatar{\n  constructor(system){\n    super('nodes/core.png',system);\n    this.tooltip='Process';\n  }\n  \n  scan(){\n    this.setimage('nodes/terminal.png');\n    this.tooltip='Terminal';\n  }\n  \n  click(){\n    super.click();\n  }\n}\n","import {rpg} from '../../rpg';\nimport {Node} from './node';\nimport {Alarm} from '../avatar/alarm';\nimport {Entry} from '../avatar/entry';\nimport {Map} from '../avatar/map';\nimport {Terminal} from '../avatar/terminal';\n\nvar FUNCTIONS=4;\n\nexport class Cpu extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=2;\n  }\n  \n  setmain(){\n    this.enter(new Alarm(this.system));\n    this.enter(new Entry(this.system));\n    this.enter(new Map(this.system));\n    this.enter(new Terminal(this.system));\n  }\n  \n  generate(){\n    while(this.avatars.length==0){\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Alarm(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Entry(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Map(this.system));\n      if(rpg.chancein(FUNCTIONS)) \n        this.enter(new Terminal(this.system));\n    }\n  }\n}\n","import {Node} from './node';\nimport {File} from '../avatar/file';\nimport {rpg} from '../../rpg';\n\nexport class Datastore extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=1;\n  }\n  \n  generate(){\n    let files=rpg.r(1,4);\n    for(let i=0;i<files;i++){\n      this.enter(new File(this.system));\n    }\n  }\n}\n","import {Node} from './node';\nimport {Backdoor} from '../avatar/backdoor';\nimport {Control} from '../avatar/control';\nimport {rpg} from '../../rpg';\n\nexport class Interface extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=1;\n  }\n  \n  generate(){\n    while(this.avatars.length==0){\n      if(rpg.chancein(4)) this.enter(new Control(this.system));\n      if(rpg.chancein(6)) this.enter(new Backdoor(this.system));\n    }\n  }\n}\n","import {rpg} from '../../rpg';\n\nvar SIZE=4;\nvar TILES=[];\n\nfor(let x=0;x<SIZE;x++) for(let y=0;y<SIZE;y++)\n  TILES.push([x,y]);\n\nexport class Node{\n  constructor(x,y,system){\n    this.x=x;\n    this.y=y;\n    this.id=system.nodes.length;\n    this.size=SIZE;\n    this.priority=0;\n    this.system=system;\n    this.avatars=[];\n    this.visited=false;\n  }\n  \n  generate(){\n    // override\n  }\n  \n  getneighbors(){\n    let neighbors=[];\n    for(let xy of [[-1,0],[+1,0],[0,+1],[0,-1]]){\n      let n=this.system.getnode(this.x+xy[0],this.y+xy[1]);\n      if(n) neighbors.push(n);\n    }\n    return neighbors;\n  }\n  \n  getavatar(x,y){\n    for(let a of this.avatars) if(a.x==x&&a.y==y) return a;\n    return null;\n  }\n  \n  remove(avatar){\n    this.avatars.splice(this.avatars.indexOf(avatar),1);\n  }\n  \n  /* return true if found free spot */\n  enter(avatar){\n    if(avatar.node==this) return true;\n    rpg.shuffle(TILES);\n    for(let xy of TILES) if(!this.getavatar(xy[0],xy[1])){\n      if(avatar.node) avatar.node.remove(avatar);\n      avatar.x=xy[0];\n      avatar.y=xy[1];\n      avatar.node=this;\n      this.avatars.push(avatar);\n      return true;\n    }\n    return false;\n  }\n  \n  /* scan avatars randomly\n   * return false if one fails or true if all done */\n  scan(){ //TODO skill test\n    for(let a of rpg.shuffle(this.avatars.slice())){\n      if(!a.scanned){\n        if(false) return false;\n        a.scan();\n        a.scanned=true;\n      }\n    }\n    return true;\n  }\n}\n","import {Node} from './node';\nimport {Gateway} from '../avatar/gateway';\n\n//TODO make it part of the normal generation to hop to other systems\n//TODO at first can even have it as \"stairs down\"\nexport class Portal extends Node{\n  constructor(x,y,system){\n    super(x,y,system)\n    this.priority=2;\n  }\n  \n  generate(){\n    this.enter(new Gateway(this.system));\n  }\n}\n"],"sourceRoot":".."}